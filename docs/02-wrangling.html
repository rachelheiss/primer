<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.0.38">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>Preceptor’s Primer for Bayesian Data Science - 2&nbsp; Wrangling</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./03-data.html" rel="next">
<link href="./01-visualization.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>
</head>
<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }"><div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Wrangling</span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Preceptor’s Primer for Bayesian Data Science</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/PPBDS/primer/" title="Source Code" class="sidebar-tool px-1"><i class="bi bi-github"></i></a>
    <a href="" title="Download" id="sidebar-tool-dropdown-0" class="sidebar-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi bi-download"></i></a>
    <ul class="dropdown-menu" aria-labelledby="sidebar-tool-dropdown-0">
<li>
          <a class="dropdown-item sidebar-tools-main-item" href="./Preceptor-s-Primer-for-Bayesian-Data-Science.pdf">
            <i class="bi bi-bi-file-pdf pe-1"></i>
          Download PDF
          </a>
        </li>
        <li>
          <a class="dropdown-item sidebar-tools-main-item" href="./Preceptor-s-Primer-for-Bayesian-Data-Science.epub">
            <i class="bi bi-bi-journal pe-1"></i>
          Download ePub
          </a>
        </li>
    </ul>
</div>
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">Welcome</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./preamble.html" class="sidebar-item-text sidebar-link">Preamble</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./00-getting-started.html" class="sidebar-item-text sidebar-link">Getting Started</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-visualization.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Visualization</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-wrangling.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Wrangling</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-data.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Data</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-rubin-causal-model.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Rubin Causal Model</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-probability.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Probability</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-one-parameter.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">One Parameter</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-two-parameters.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Two Parameters</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-three-parameters.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Three Parameters</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09-four-parameters.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Four Parameters</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10-five-parameters.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Five Parameters</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11-n-parameters.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">N Parameters</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./tools.html" class="sidebar-item-text sidebar-link">Tools</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./animation.html" class="sidebar-item-text sidebar-link">Animation</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./set-up.html" class="sidebar-item-text sidebar-link">Set Up for Working on The Primer</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">References</a>
  </div>
</li>
    </ul>
</div>
</nav><!-- margin-sidebar --><div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li>
<a href="#tibbles" id="toc-tibbles" class="nav-link active" data-scroll-target="#tibbles"> <span class="header-section-number">2.1</span> Tibbles</a>
  <ul class="collapse">
<li><a href="#tibble" id="toc-tibble" class="nav-link" data-scroll-target="#tibble"> <span class="header-section-number">2.1.1</span> <code>tibble()</code></a></li>
  </ul>
</li>
  <li>
<a href="#lists" id="toc-lists" class="nav-link" data-scroll-target="#lists"> <span class="header-section-number">2.2</span> Lists</a>
  <ul class="collapse">
<li><a href="#visualizing-lists" id="toc-visualizing-lists" class="nav-link" data-scroll-target="#visualizing-lists"> <span class="header-section-number">2.2.1</span> Visualizing lists</a></li>
  <li><a href="#subsetting" id="toc-subsetting" class="nav-link" data-scroll-target="#subsetting"> <span class="header-section-number">2.2.2</span> Subsetting</a></li>
  </ul>
</li>
  <li>
<a href="#characters" id="toc-characters" class="nav-link" data-scroll-target="#characters"> <span class="header-section-number">2.3</span> Characters</a>
  <ul class="collapse">
<li><a href="#character-vectors" id="toc-character-vectors" class="nav-link" data-scroll-target="#character-vectors"> <span class="header-section-number">2.3.1</span> Character vectors</a></li>
  <li><a href="#regular-expressions-with-stringr" id="toc-regular-expressions-with-stringr" class="nav-link" data-scroll-target="#regular-expressions-with-stringr"> <span class="header-section-number">2.3.2</span> Regular expressions with stringr</a></li>
  </ul>
</li>
  <li>
<a href="#factors" id="toc-factors" class="nav-link" data-scroll-target="#factors"> <span class="header-section-number">2.4</span> Factors</a>
  <ul class="collapse">
<li><a href="#dropping-unused-levels" id="toc-dropping-unused-levels" class="nav-link" data-scroll-target="#dropping-unused-levels"> <span class="header-section-number">2.4.1</span> Dropping unused levels</a></li>
  <li><a href="#change-the-order-of-the-levels" id="toc-change-the-order-of-the-levels" class="nav-link" data-scroll-target="#change-the-order-of-the-levels"> <span class="header-section-number">2.4.2</span> Change the order of the levels</a></li>
  <li><a href="#recode-the-levels" id="toc-recode-the-levels" class="nav-link" data-scroll-target="#recode-the-levels"> <span class="header-section-number">2.4.3</span> Recode the levels</a></li>
  </ul>
</li>
  <li>
<a href="#date-times" id="toc-date-times" class="nav-link" data-scroll-target="#date-times"> <span class="header-section-number">2.5</span> Date-Times</a>
  <ul class="collapse">
<li><a href="#from-strings" id="toc-from-strings" class="nav-link" data-scroll-target="#from-strings"> <span class="header-section-number">2.5.1</span> From strings</a></li>
  <li><a href="#from-individual-components" id="toc-from-individual-components" class="nav-link" data-scroll-target="#from-individual-components"> <span class="header-section-number">2.5.2</span> From individual components</a></li>
  <li><a href="#from-other-types" id="toc-from-other-types" class="nav-link" data-scroll-target="#from-other-types"> <span class="header-section-number">2.5.3</span> From other types</a></li>
  <li><a href="#date-time-components" id="toc-date-time-components" class="nav-link" data-scroll-target="#date-time-components"> <span class="header-section-number">2.5.4</span> Date-time components</a></li>
  <li><a href="#setting-components" id="toc-setting-components" class="nav-link" data-scroll-target="#setting-components"> <span class="header-section-number">2.5.5</span> Setting components</a></li>
  <li><a href="#time-zones" id="toc-time-zones" class="nav-link" data-scroll-target="#time-zones"> <span class="header-section-number">2.5.6</span> Time zones</a></li>
  </ul>
</li>
  <li>
<a href="#combining-data" id="toc-combining-data" class="nav-link" data-scroll-target="#combining-data"> <span class="header-section-number">2.6</span> Combining Data</a>
  <ul class="collapse">
<li><a href="#joins" id="toc-joins" class="nav-link" data-scroll-target="#joins"> <span class="header-section-number">2.6.1</span> Joins</a></li>
  <li><a href="#example" id="toc-example" class="nav-link" data-scroll-target="#example"> <span class="header-section-number">2.6.2</span> Example</a></li>
  </ul>
</li>
  <li>
<a href="#tidy-data" id="toc-tidy-data" class="nav-link" data-scroll-target="#tidy-data"> <span class="header-section-number">2.7</span> Tidy data</a>
  <ul class="collapse">
<li><a href="#definition-of-tidy-data" id="toc-definition-of-tidy-data" class="nav-link" data-scroll-target="#definition-of-tidy-data"> <span class="header-section-number">2.7.1</span> Definition of “tidy” data</a></li>
  <li><a href="#converting-to-tidy-data" id="toc-converting-to-tidy-data" class="nav-link" data-scroll-target="#converting-to-tidy-data"> <span class="header-section-number">2.7.2</span> Converting to “tidy” data</a></li>
  </ul>
</li>
  <li>
<a href="#other-commands" id="toc-other-commands" class="nav-link" data-scroll-target="#other-commands"> <span class="header-section-number">2.8</span> Other commands</a>
  <ul class="collapse">
<li><a href="#random-variables" id="toc-random-variables" class="nav-link" data-scroll-target="#random-variables"> <span class="header-section-number">2.8.1</span> Random variables</a></li>
  <li><a href="#combinations" id="toc-combinations" class="nav-link" data-scroll-target="#combinations"> <span class="header-section-number">2.8.2</span> Combinations</a></li>
  <li><a href="#matrices" id="toc-matrices" class="nav-link" data-scroll-target="#matrices"> <span class="header-section-number">2.8.3</span> Matrices</a></li>
  <li><a href="#missing-values" id="toc-missing-values" class="nav-link" data-scroll-target="#missing-values"> <span class="header-section-number">2.8.4</span> Missing Values</a></li>
  <li><a href="#working-by-rows" id="toc-working-by-rows" class="nav-link" data-scroll-target="#working-by-rows"> <span class="header-section-number">2.8.5</span> Working by rows</a></li>
  <li><a href="#using-skim" id="toc-using-skim" class="nav-link" data-scroll-target="#using-skim"> <span class="header-section-number">2.8.6</span> Using <code>skim()</code></a></li>
  </ul>
</li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary"> <span class="header-section-number">2.9</span> Summary</a></li>
  </ul><div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/PPBDS/primer/edit/main/02-wrangling.qmd" class="toc-action">Edit this page</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title"><span id="sec-wrangling" class="quarto-section-identifier d-none d-lg-block"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Wrangling</span></span></h1>
</div>



<div class="quarto-title-meta">

    
    
  </div>
  

</header><!-- Replace flights with fec16? airlines are boring. Got rid of 538?  --><!-- Add in other join diagrams, like the one used for for inner join? --><!-- Start joins with left_join, since it is most important. --><!-- Potentially order the tips and tricks relevant to wrangling: --><!-- https://moderndive.com/C-appendixC.html --><p><em>Data science is data cleaning.</em></p>
<p>Start by loading the packages which we will need in this chapter.</p>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">primer.data</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://lubridate.tidyverse.org">lubridate</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/skimr/">skimr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/hadley/nycflights13">nycflights13</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jennybc/gapminder">gapminder</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/rudeboybert/fivethirtyeight">fivethirtyeight</a></span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<!-- List these as bulleted lists so that they are easier to read. -->
<!-- AM: I don't recall if all 8 Tidyverse sub-packages are used in this chapter, but I'd say here which ones are actually used (such as stringr) -->
<!-- AM: 538's description is too vague - additionally, the actual usage of 538 in this chapter suggests more that it provides data, not that it cleans it up. I may be wrong, though. -->
<ul>
<li>The <strong>tidyverse</strong> package will be used in every chapter. Loading it makes the 8 packages from the “Tidyverse” available.</li>
<li>
<strong>primer.data</strong> is the data package created specifically for the primer.</li>
<li>
<strong>lubridate</strong> is a package for working with dates and times.</li>
<li>
<strong>skimr</strong> contains functions that are useful for providing summary statistics, especially <code><a href="https://docs.ropensci.org/skimr/reference/skim.html">skim()</a></code>.</li>
<li>
<strong>nycflights13</strong> includes data associated with flights out of New York City’s three major airports.</li>
<li>
<strong>gapminder</strong> has annual data for countries going back more than 50 years, which we used in <span class="citation" data-cites="visualization">(<a href="references.html#ref-visualization" role="doc-biblioref"><strong>visualization?</strong></a>)</span>.</li>
<li>
<strong>fivethirtyeight</strong> cleans up data from the <a href="https://fivethirtyeight.com/">FiveThirtyEight</a> team.</li>
</ul>
<section id="tibbles" class="level2" data-number="2.1"><h2 data-number="2.1" class="anchored" data-anchor-id="tibbles">
<span class="header-section-number">2.1</span> Tibbles</h2>
<!-- AM: This description of a tibble is unnecessarily wordy. -->
<p>Tibbles are a kind of data frame, useful for storing data in which we have the same number of observations for each variable. We can use the <code><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble()</a></code> function to create tibbles. Tibbles are composed of columns, each of which is a variable, and rows, each of which is a “unit” or an “observation.” Furthermore, each column (i.e., each variable) can be of a different type: character, integer, factor, double, date and so on.</p>
<!-- AM: Probably mention how we've already used tibbles, such as the trains dataset from Chapter 1. -->
<section id="tibble" class="level3" data-number="2.1.1"><h3 data-number="2.1.1" class="anchored" data-anchor-id="tibble">
<span class="header-section-number">2.1.1</span> <code>tibble()</code>
</h3>
<div class="cell">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fl">2.1</span>, b <span class="op">=</span> <span class="st">"Hello"</span>, c <span class="op">=</span> <span class="cn">TRUE</span>, d <span class="op">=</span> <span class="fl">9L</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 4
      a b     c         d
  &lt;dbl&gt; &lt;chr&gt; &lt;lgl&gt; &lt;int&gt;
1   2.1 Hello TRUE      9</code></pre>
</div>
</div>
<!-- AM: Also unnecessarily wordy. -->
<p>In our code, we specify the column names as , <code>a</code>, <code>b</code>, and <code>c</code>. Under each variable, we give a different value. Under each variable name, the data type is specified for the data within that column. A tibble can consist of one or more atomic vectors, the most important types of which are double, character, logical, and integer. The tibble above includes a variable of each type. The “L” in “9L” tells R that we want <code>d</code> to be an integer rather than the default, which would be a double. When you print out a tibble, the variable type is shown below the variable name, as indicated by <code>&lt;dbl&gt;</code>, <code>&lt;chr&gt;</code>, and so on.</p>
<!-- Add note about data in the wild. -->
<p>Variables should not begin with a number (like <code>54abc</code>) or include spaces (like <code>my var</code>). If you insist on using variable names such, you must include backticks around each name when you reference it.</p>
<div class="cell">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>`54abc` <span class="op">=</span> <span class="fl">1</span>, `my var` <span class="op">=</span> <span class="fl">2</span>, c <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 3
  `54abc` `my var`     c
    &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;
1       1        2     3</code></pre>
</div>
</div>
<p>If we did not include the backticks, R would give us an error.</p>
<div class="cell" data-renv.ignore="true">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(54abc <span class="ot">=</span> <span class="dv">1</span>, my <span class="at">var =</span> <span class="dv">2</span>, <span class="at">c =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error: &lt;text&gt;:1:10: unexpected symbol
1: tibble(54abc
             ^</code></pre>
</div>
</div>
<p>In the real world, you may come across datasets with dirty column names such as <code>54abc</code> or <code>my var</code>.</p>
<p>It is sometimes easier to use the function <code><a href="https://tibble.tidyverse.org/reference/tribble.html">tribble()</a></code> to create tibbles.</p>
<div class="cell">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html">tribble</a></span><span class="op">(</span></span>
<span>  <span class="op">~</span> <span class="va">var1</span>, <span class="op">~</span> <span class="va">`var 2`</span>, <span class="op">~</span> <span class="va">myvar</span>,</span>
<span>  <span class="fl">1</span>,           <span class="fl">3</span>,      <span class="fl">5</span>,</span>
<span>  <span class="fl">4</span>,           <span class="fl">6</span>,      <span class="fl">8</span>,</span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 3
   var1 `var 2` myvar
  &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;
1     1       3     5
2     4       6     8</code></pre>
</div>
</div>
<!-- AM: The last part of this sentence is confusing. -->
<p>The tildes — as in <code>~ var1</code> — specify which row has the column names. The formatting makes it easier, relative to specifying raw vectors, to see which values are from the same observation.</p>
</section></section><section id="lists" class="level2" data-number="2.2"><h2 data-number="2.2" class="anchored" data-anchor-id="lists">
<span class="header-section-number">2.2</span> Lists</h2>
<!-- AM: Shouldn't the figure come AFTER the first demonstration of `list()` on lines 113-116? -->
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="02-wrangling/images/lists-subsetting.png" class="img-fluid figure-img" width="417"></p>
<p></p><figcaption class="figure-caption">Subsetting a list, visually.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>Earlier, we briefly introduced lists. Lists are a type of vector that is a step up in complexity from atomic vectors, because lists can contain other lists. This makes them suitable for representing hierarchical or tree-like structures. You create a list with the function <code><a href="https://rdrr.io/r/base/list.html">list()</a></code>:</p>
<div class="cell">
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">x</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[1] 1

[[2]]
[1] 2

[[3]]
[1] 3</code></pre>
</div>
</div>
<p>A very useful tool for working with lists is <code><a href="https://rdrr.io/r/utils/str.html">str()</a></code> because it focuses on displaying the <strong>str</strong>ucture, not the contents.</p>
<div class="cell">
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 3
 $ : num 1
 $ : num 2
 $ : num 3</code></pre>
</div>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">x_named</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fl">1</span>, b <span class="op">=</span> <span class="fl">2</span>, c <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">x_named</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 3
 $ a: num 1
 $ b: num 2
 $ c: num 3</code></pre>
</div>
</div>
<p>Unlike atomic vectors, <code><a href="https://rdrr.io/r/base/list.html">list()</a></code> can contain objects of several types.</p>
<div class="cell">
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="fl">1L</span>, <span class="fl">1.5</span>, <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 4
 $ : chr "a"
 $ : int 1
 $ : num 1.5
 $ : logi TRUE</code></pre>
</div>
</div>
<p>Lists can even contain other lists!</p>
<div class="cell">
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">z</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">z</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 2
 $ :List of 2
  ..$ : num 1
  ..$ : num 2
 $ :List of 2
  ..$ : num 3
  ..$ : num 4</code></pre>
</div>
</div>
<section id="visualizing-lists" class="level3" data-number="2.2.1"><h3 data-number="2.2.1" class="anchored" data-anchor-id="visualizing-lists">
<span class="header-section-number">2.2.1</span> Visualizing lists</h3>
<p>To explain more complicated list manipulation functions, it’s helpful to have a visual representation of lists. For example, take these three lists:</p>
<div class="cell">
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">x1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">x2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">x3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>They are structured as follows:</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="02-wrangling/images/lists-structure.png" class="img-fluid" width="406"></p>
</div>
</div>
<p>There are three principles:</p>
<ol type="1">
<li><p>Lists have rounded corners. Atomic vectors have square corners.</p></li>
<li><p>Children are drawn inside their parent, and have a slightly darker background to make it easier to see the hierarchy.</p></li>
<li><p>The orientation of the children (i.e.&nbsp;rows or columns) isn’t important, so I’ll pick a row or column orientation to either save space or illustrate an important property in the example.</p></li>
</ol></section><section id="subsetting" class="level3" data-number="2.2.2"><h3 data-number="2.2.2" class="anchored" data-anchor-id="subsetting">
<span class="header-section-number">2.2.2</span> Subsetting</h3>
<p>There are three ways to subset a list, which I’ll illustrate with a list named <code>a</code>:</p>
<div class="cell">
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, b <span class="op">=</span> <span class="st">"a string"</span>, c <span class="op">=</span> <span class="va">pi</span>, d <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="op">-</span><span class="fl">5</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>[ ]</code> extracts a sub-list. The result will always be a list.</p>
<div class="cell">
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">a</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 2
 $ a: int [1:3] 1 2 3
 $ b: chr "a string"</code></pre>
</div>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">a</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 1
 $ d:List of 2
  ..$ : num -1
  ..$ : num -5</code></pre>
</div>
</div>
<p>Like with vectors, you can subset with a logical, integer, or character vector.</p>
<p><code>[[ ]]</code> extracts a single component from a list. It removes a level of hierarchy from the list.</p>
<div class="cell">
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">a</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> int [1:3] 1 2 3</code></pre>
</div>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">a</span><span class="op">[[</span><span class="fl">4</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 2
 $ : num -1
 $ : num -5</code></pre>
</div>
</div>
<p><code>$</code> is a shorthand for extracting named elements of a list. It works similarly to <code>[[ ]]</code> except that you don’t need to use quotes.</p>
<div class="cell">
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">a</span><span class="op">$</span><span class="va">a</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1 2 3</code></pre>
</div>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">a</span><span class="op">[[</span><span class="st">"a"</span><span class="op">]</span><span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1 2 3</code></pre>
</div>
</div>
<p>The distinction between <code>[ ]</code> and <code>[[ ]]</code> is really important for lists, because <code>[[ ]]</code> drills down into the list while <code>[ ]</code> returns a new, smaller list. Compare the code and output above with the visual representation.</p>
</section></section><section id="characters" class="level2" data-number="2.3"><h2 data-number="2.3" class="anchored" data-anchor-id="characters">
<span class="header-section-number">2.3</span> Characters</h2>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="02-wrangling/images/nasty.gif" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Real data is nasty.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<!-- AM: These first three sentences should preface the chapter. -->
<p>So far, our tibbles have been clean and wholesome, like <code>gapminder</code> and <code>trains</code>. <strong>Real data is nasty.</strong> You will bring data into R from the outside world and discover there are problems. We will now discuss common remedial tasks for cleaning and transforming character data, also known as strings. A <em>string</em> is one or more characters that are enclosed inside a pair of matching ‘single’ or “double quotes”.</p>
<!-- AM: This could be worded better. -->
<p>We will use the <code>fruit</code> data, a vector with the names of different fruits, from the <strong>stringr</strong> package, which is automatically loaded when we issue <code><a href="https://tidyverse.tidyverse.org">library(tidyverse)</a></code>. Although we can manipulate character vectors directly, it is much more common, in real world situations, to work with vectors which are in a tibble.</p>
<!-- AM: Should this codeblock be put beneath the "Character vectors" section? -->
<div class="cell">
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">tbl_fruit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>fruit <span class="op">=</span> <span class="va">fruit</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="character-vectors" class="level3" data-number="2.3.1"><h3 data-number="2.3.1" class="anchored" data-anchor-id="character-vectors">
<span class="header-section-number">2.3.1</span> Character vectors</h3>
<div class="cell">
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">tbl_fruit</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_sample</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">8</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 8 × 1
  fruit     
  &lt;chr&gt;     
1 grapefruit
2 jackfruit 
3 damson    
4 goji berry
5 strawberry
6 gooseberry
7 rock melon
8 satsuma   </code></pre>
</div>
</div>
<!-- AM: Demonstrate a use of the `prop` argument? Or just delete it entirely? -->
<p>Note that <code><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_sample()</a></code> selects a random set of rows from the tibble. The argument <code>n</code>, as shown above, will display that many rows. Use the argument <code>prop</code> to return a specific percentage of all the rows in the tibble.</p>
<p><code><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect()</a></code> determines if a character vector matches a pattern. It returns a logical vector that is the same length as the input. Recall logicals are either <code>TRUE</code> or <code>FALSE</code>.</p>
<p>Which fruit names actually include the letter “c?”</p>
<div class="cell">
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">tbl_fruit</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>fruit_in_name <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">fruit</span>, pattern <span class="op">=</span> <span class="st">"c"</span><span class="op">)</span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 80 × 2
   fruit        fruit_in_name
   &lt;chr&gt;        &lt;lgl&gt;        
 1 apple        FALSE        
 2 apricot      TRUE         
 3 avocado      TRUE         
 4 banana       FALSE        
 5 bell pepper  FALSE        
 6 bilberry     FALSE        
 7 blackberry   TRUE         
 8 blackcurrant TRUE         
 9 blood orange FALSE        
10 blueberry    FALSE        
# … with 70 more rows
# ℹ Use `print(n = ...)` to see more rows</code></pre>
</div>
</div>
<!-- AM: How is it different? Demonstrate a usage of `length()`? -->
<p><code><a href="https://stringr.tidyverse.org/reference/str_length.html">str_length()</a></code> counts characters in your strings. Note this is different from the <code><a href="https://rdrr.io/r/base/length.html">length()</a></code> of the character vector itself.</p>
<div class="cell">
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">tbl_fruit</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>name_length <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_length.html">str_length</a></span><span class="op">(</span><span class="va">fruit</span><span class="op">)</span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 80 × 2
   fruit        name_length
   &lt;chr&gt;              &lt;int&gt;
 1 apple                  5
 2 apricot                7
 3 avocado                7
 4 banana                 6
 5 bell pepper           11
 6 bilberry               8
 7 blackberry            10
 8 blackcurrant          12
 9 blood orange          12
10 blueberry              9
# … with 70 more rows
# ℹ Use `print(n = ...)` to see more rows</code></pre>
</div>
</div>
<p><code><a href="https://stringr.tidyverse.org/reference/str_sub.html">str_sub()</a></code> returns a portion of a string. This demonstration will return the first three letters of each <code>fruit</code> with the arguments <code>fruit</code>, <code>1</code>, and <code>3</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">tbl_fruit</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>first_three_letters <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_sub.html">str_sub</a></span><span class="op">(</span><span class="va">fruit</span>, <span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 80 × 2
   fruit        first_three_letters
   &lt;chr&gt;        &lt;chr&gt;              
 1 apple        app                
 2 apricot      apr                
 3 avocado      avo                
 4 banana       ban                
 5 bell pepper  bel                
 6 bilberry     bil                
 7 blackberry   bla                
 8 blackcurrant bla                
 9 blood orange blo                
10 blueberry    blu                
# … with 70 more rows
# ℹ Use `print(n = ...)` to see more rows</code></pre>
</div>
</div>
<p><code><a href="https://stringr.tidyverse.org/reference/str_c.html">str_c()</a></code> combines a character vector of length to a single string. This is similar to the normal <code><a href="https://rdrr.io/r/base/c.html">c()</a></code> function for creating a vector.</p>
<div class="cell">
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">tbl_fruit</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>name_with_s <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_c.html">str_c</a></span><span class="op">(</span><span class="va">fruit</span>, <span class="st">"s"</span><span class="op">)</span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 80 × 2
   fruit        name_with_s  
   &lt;chr&gt;        &lt;chr&gt;        
 1 apple        apples       
 2 apricot      apricots     
 3 avocado      avocados     
 4 banana       bananas      
 5 bell pepper  bell peppers 
 6 bilberry     bilberrys    
 7 blackberry   blackberrys  
 8 blackcurrant blackcurrants
 9 blood orange blood oranges
10 blueberry    blueberrys   
# … with 70 more rows
# ℹ Use `print(n = ...)` to see more rows</code></pre>
</div>
</div>
<p><code><a href="https://stringr.tidyverse.org/reference/str_replace.html">str_replace()</a></code> replaces a pattern within a string.</p>
<div class="cell">
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">tbl_fruit</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>capital_A <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html">str_replace</a></span><span class="op">(</span><span class="va">fruit</span>, </span>
<span>                                 pattern <span class="op">=</span> <span class="st">"a"</span>, </span>
<span>                                 replacement <span class="op">=</span> <span class="st">"A"</span><span class="op">)</span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 80 × 2
   fruit        capital_A   
   &lt;chr&gt;        &lt;chr&gt;       
 1 apple        Apple       
 2 apricot      Apricot     
 3 avocado      Avocado     
 4 banana       bAnana      
 5 bell pepper  bell pepper 
 6 bilberry     bilberry    
 7 blackberry   blAckberry  
 8 blackcurrant blAckcurrant
 9 blood orange blood orAnge
10 blueberry    blueberry   
# … with 70 more rows
# ℹ Use `print(n = ...)` to see more rows</code></pre>
</div>
</div>
</section><section id="regular-expressions-with-stringr" class="level3" data-number="2.3.2"><h3 data-number="2.3.2" class="anchored" data-anchor-id="regular-expressions-with-stringr">
<span class="header-section-number">2.3.2</span> Regular expressions with stringr</h3>
<p>Sometimes, your string tasks cannot be expressed in terms of a fixed string, but can be described in terms of a pattern. Regular expressions, also know as “regexes,” are the standard way to specify these patterns. In regexes, specific characters and constructs take on special meaning in order to match multiple strings.</p>
<p>To explore regular expressions, we will use the <code><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect()</a></code> function, which reports TRUE for any string which matches the pattern, and then <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> to see all the matches. For example, here are all the fruits which include a “w” in their name.</p>
<div class="cell">
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">tbl_fruit</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">fruit</span>, pattern <span class="op">=</span> <span class="st">"w"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 1
  fruit     
  &lt;chr&gt;     
1 honeydew  
2 kiwi fruit
3 strawberry
4 watermelon</code></pre>
</div>
</div>
<p>In the code below, the first metacharacter is the period <code>.</code> , which stands for any single character, except a newline (which, by the way, is represented by <code>\n</code>). The regex <code>b.r</code> will match all fruits that have an “b”, followed by any single character, followed by “r”. Regexes are case sensitive.</p>
<div class="cell">
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">tbl_fruit</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">fruit</span>, pattern <span class="op">=</span> <span class="st">"b.r"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 15 × 1
   fruit      
   &lt;chr&gt;      
 1 bilberry   
 2 blackberry 
 3 blueberry  
 4 boysenberry
 5 cloudberry 
 6 cranberry  
 7 cucumber   
 8 elderberry 
 9 goji berry 
10 gooseberry 
11 huckleberry
12 mulberry   
13 raspberry  
14 salal berry
15 strawberry </code></pre>
</div>
</div>
<p>Anchors can be included to express where the expression must occur within the string. The <code>^</code> indicates the beginning of string and <code>$</code> indicates the end.</p>
<div class="cell">
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">tbl_fruit</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">fruit</span>, pattern <span class="op">=</span> <span class="st">"^w"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 1
  fruit     
  &lt;chr&gt;     
1 watermelon</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">tbl_fruit</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">fruit</span>, pattern <span class="op">=</span> <span class="st">"o$"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 1
  fruit    
  &lt;chr&gt;    
1 avocado  
2 mango    
3 pamelo   
4 pomelo   
5 tamarillo</code></pre>
</div>
</div>
<!-- We cut our raw strings from here. Bring back?   -->
</section></section><section id="factors" class="level2" data-number="2.4"><h2 data-number="2.4" class="anchored" data-anchor-id="factors">
<span class="header-section-number">2.4</span> Factors</h2>
<p>Factors are <em>categorical</em> variables that only take on a specified set of values. To manipulate factors we will use the <strong>forcats</strong> package, a core package in the Tidyverse.</p>
<p>It is easy to make factors with either <code><a href="https://rdrr.io/r/base/factor.html">factor()</a></code>, <code><a href="https://rdrr.io/r/base/factor.html">as.factor()</a></code> or <code><a href="https://readr.tidyverse.org/reference/parse_factor.html">parse_factor()</a></code>.</p>
<div class="cell">
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">letters</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>fac_1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>fac_2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>fac_3 <span class="op">=</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/parse_factor.html">parse_factor</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  X     fac_1 fac_2 fac_3
  &lt;chr&gt; &lt;fct&gt; &lt;fct&gt; &lt;fct&gt;
1 a     a     a     a    
2 b     b     b     b    
3 c     c     c     c    </code></pre>
</div>
</div>
<p>Which of those three options is best depends on the situation. <code><a href="https://rdrr.io/r/base/factor.html">factor()</a></code> is useful when you are creating a factor from nothing. <code><a href="https://rdrr.io/r/base/factor.html">as.factor()</a></code> is best for simple transformations, especially of character variables, as in this example. <code><a href="https://readr.tidyverse.org/reference/parse_factor.html">parse_factor()</a></code> is the most modern and powerful of the three.</p>
<!-- DK: Too awkward! -->
<p>Let’s use <code>gapminder$continent</code> as an example. Note that <code><a href="https://rdrr.io/r/utils/str.html">str()</a></code> is a useful function for getting detailed information about an object.</p>
<div class="cell">
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">gapminder</span><span class="op">$</span><span class="va">continent</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Factor w/ 5 levels "Africa","Americas",..: 3 3 3 3 3 3 3 3 3 3 ...</code></pre>
</div>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">gapminder</span><span class="op">$</span><span class="va">continent</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Africa"   "Americas" "Asia"     "Europe"   "Oceania" </code></pre>
</div>
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/nlevels.html">nlevels</a></span><span class="op">(</span><span class="va">gapminder</span><span class="op">$</span><span class="va">continent</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 5</code></pre>
</div>
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">gapminder</span><span class="op">$</span><span class="va">continent</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "factor"</code></pre>
</div>
</div>
<p>To get a frequency table as a tibble, from a tibble, use <code><a href="https://dplyr.tidyverse.org/reference/count.html">count()</a></code>. To get a similar result from a free-range factor, use <code><a href="https://forcats.tidyverse.org/reference/fct_count.html">fct_count()</a></code>.</p>
<div class="cell">
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">gapminder</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="va">continent</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 2
  continent     n
  &lt;fct&gt;     &lt;int&gt;
1 Africa      624
2 Americas    300
3 Asia        396
4 Europe      360
5 Oceania      24</code></pre>
</div>
<div class="sourceCode" id="cb67"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_count.html">fct_count</a></span><span class="op">(</span><span class="va">gapminder</span><span class="op">$</span><span class="va">continent</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 2
  f            n
  &lt;fct&gt;    &lt;int&gt;
1 Africa     624
2 Americas   300
3 Asia       396
4 Europe     360
5 Oceania     24</code></pre>
</div>
</div>
<section id="dropping-unused-levels" class="level3" data-number="2.4.1"><h3 data-number="2.4.1" class="anchored" data-anchor-id="dropping-unused-levels">
<span class="header-section-number">2.4.1</span> Dropping unused levels</h3>
<p>Removing all the rows corresponding to a specific factor level does not remove the level itself. These unused levels can come back to haunt you later, e.g., in figure legends.</p>
<p>Watch what happens to the levels of <code>country</code> when we filter <code>gapminder</code> to a handful of countries.</p>
<div class="cell">
<div class="sourceCode" id="cb69"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/nlevels.html">nlevels</a></span><span class="op">(</span><span class="va">gapminder</span><span class="op">$</span><span class="va">country</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 142</code></pre>
</div>
<div class="sourceCode" id="cb71"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">h_gap</span> <span class="op">&lt;-</span> <span class="va">gapminder</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">country</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Egypt"</span>, <span class="st">"Haiti"</span>, </span>
<span>                        <span class="st">"Romania"</span>, <span class="st">"Thailand"</span>, </span>
<span>                        <span class="st">"Venezuela"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nlevels.html">nlevels</a></span><span class="op">(</span><span class="va">h_gap</span><span class="op">$</span><span class="va">country</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 142</code></pre>
</div>
</div>
<p>Even though <code>h_gap</code> only has data for a handful of countries, we are still schlepping around all levels from the original <code>gapminder</code> tibble.</p>
<p>How can you get rid of them? The base function <code><a href="https://rdrr.io/r/base/droplevels.html">droplevels()</a></code> operates on all the factors in a data frame or on a single factor. The function <code><a href="https://forcats.tidyverse.org/reference/fct_drop.html">fct_drop()</a></code> operates on a single factor variable.</p>
<div class="cell">
<div class="sourceCode" id="cb73"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">h_gap_dropped</span> <span class="op">&lt;-</span> <span class="va">h_gap</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/droplevels.html">droplevels</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nlevels.html">nlevels</a></span><span class="op">(</span><span class="va">h_gap_dropped</span><span class="op">$</span><span class="va">country</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 5</code></pre>
</div>
<div class="sourceCode" id="cb75"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Use fct_drop() on a free-range factor</span></span>
<span></span>
<span><span class="va">h_gap</span><span class="op">$</span><span class="va">country</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_drop.html">fct_drop</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Egypt"     "Haiti"     "Romania"   "Thailand"  "Venezuela"</code></pre>
</div>
</div>
</section><section id="change-the-order-of-the-levels" class="level3" data-number="2.4.2"><h3 data-number="2.4.2" class="anchored" data-anchor-id="change-the-order-of-the-levels">
<span class="header-section-number">2.4.2</span> Change the order of the levels</h3>
<p>By default, factor levels are ordered alphabetically.</p>
<div class="cell">
<div class="sourceCode" id="cb77"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">gapminder</span><span class="op">$</span><span class="va">continent</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Africa"   "Americas" "Asia"     "Europe"   "Oceania" </code></pre>
</div>
</div>
<p>We can also order factors by:</p>
<ol type="1">
<li>Frequency: Make the most common level the first and so on.</li>
<li>Another variable: Order factor levels according to a summary statistic for another variable.</li>
</ol>
<p>Let’s order continent by frequency using <code><a href="https://forcats.tidyverse.org/reference/fct_inorder.html">fct_infreq()</a></code>.</p>
<div class="cell">
<div class="sourceCode" id="cb79"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">gapminder</span><span class="op">$</span><span class="va">continent</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_inorder.html">fct_infreq</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Africa"   "Asia"     "Europe"   "Americas" "Oceania" </code></pre>
</div>
</div>
<p>We can also have the frequency print out backwards using <code><a href="https://forcats.tidyverse.org/reference/fct_rev.html">fct_rev()</a></code>.</p>
<div class="cell">
<div class="sourceCode" id="cb81"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">gapminder</span><span class="op">$</span><span class="va">continent</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_inorder.html">fct_infreq</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_rev.html">fct_rev</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Oceania"  "Americas" "Europe"   "Asia"     "Africa"  </code></pre>
</div>
</div>
<p>These two bar charts of frequency by continent differ only in the order of the continents. Which do you prefer? We show the code for just the second one.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="02-wrangling_files/figure-html/unnamed-chunk-37-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb83"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">gapminder</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>continent <span class="op">=</span> <span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_inorder.html">fct_infreq</a></span><span class="op">(</span><span class="va">continent</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>continent <span class="op">=</span> <span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_rev.html">fct_rev</a></span><span class="op">(</span><span class="va">continent</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">continent</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html">coord_flip</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="02-wrangling_files/figure-html/unnamed-chunk-38-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Let’s now order <code>country</code> by another variable, forwards and backwards. This other variable is usually quantitative and you will order the factor according to a grouped summary. The factor is the grouping variable and the default summarizing function is <code><a href="https://rdrr.io/r/stats/median.html">median()</a></code> but you can specify something else.</p>
<div class="cell">
<div class="sourceCode" id="cb84"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Order countries by median life expectancy</span></span>
<span></span>
<span><span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_reorder.html">fct_reorder</a></span><span class="op">(</span><span class="va">gapminder</span><span class="op">$</span><span class="va">country</span>, </span>
<span>            <span class="va">gapminder</span><span class="op">$</span><span class="va">lifeExp</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Sierra Leone"  "Guinea-Bissau" "Afghanistan"   "Angola"       
[5] "Somalia"       "Guinea"       </code></pre>
</div>
<div class="sourceCode" id="cb86"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Order according to minimum life exp instead of median</span></span>
<span></span>
<span><span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_reorder.html">fct_reorder</a></span><span class="op">(</span><span class="va">gapminder</span><span class="op">$</span><span class="va">country</span>, </span>
<span>            <span class="va">gapminder</span><span class="op">$</span><span class="va">lifeExp</span>, <span class="va">min</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Rwanda"       "Afghanistan"  "Gambia"       "Angola"       "Sierra Leone"
[6] "Cambodia"    </code></pre>
</div>
<div class="sourceCode" id="cb88"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Backwards!</span></span>
<span></span>
<span><span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_reorder.html">fct_reorder</a></span><span class="op">(</span><span class="va">gapminder</span><span class="op">$</span><span class="va">country</span>, </span>
<span>            <span class="va">gapminder</span><span class="op">$</span><span class="va">lifeExp</span>, </span>
<span>            .desc <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Iceland"     "Japan"       "Sweden"      "Switzerland" "Netherlands"
[6] "Norway"     </code></pre>
</div>
</div>
<p>Why do we reorder factor levels? It often makes plots much better! When plotting a factor against a numeric variable, it is generally a good idea to order the factors by some function of the numeric variable. Alphabetic ordering is rarely best.</p>
<p>Compare the interpretability of these two plots of life expectancy in the Aericas in 2007. The only difference is the order of the <code>country</code> factor. Which is better?</p>
<div class="cell">
<div class="sourceCode" id="cb90"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">gapminder</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2007</span>, </span>
<span>         <span class="va">continent</span> <span class="op">==</span> <span class="st">"Americas"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">lifeExp</span>, y <span class="op">=</span> <span class="va">country</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="02-wrangling_files/figure-html/unnamed-chunk-40-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb91"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">gapminder</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2007</span>, </span>
<span>         <span class="va">continent</span> <span class="op">==</span> <span class="st">"Americas"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">lifeExp</span>, </span>
<span>             y <span class="op">=</span> <span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_reorder.html">fct_reorder</a></span><span class="op">(</span><span class="va">country</span>, <span class="va">lifeExp</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="02-wrangling_files/figure-html/unnamed-chunk-41-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<!-- Use `fct_reorder2()` when you have a line chart of a quantitative x against another quantitative y and your factor provides the color. This way the legend appears in the same order as the data! Note, the order is taken by the right side of the plot (not the left). Contrast the legend on the left with the one on the right.  -->
<!-- ```{r legends-made-for-humans, fig.show = 'hold', out.width = '49%', out.height="80%", echo = FALSE} -->
<!-- h_countries <- c("Egypt", "Haiti", "Romania", "Thailand", "Venezuela") -->
<!-- h_gap <- gapminder |> -->
<!--   filter(country %in% h_countries) |>  -->
<!--   droplevels() -->
<!-- ggplot(h_gap, aes(x = year, y = lifeExp, color = country)) + -->
<!--   geom_line() -->
<!-- ggplot(h_gap, aes(x = year, y = lifeExp, -->
<!--                   color = fct_reorder2(country, year, lifeExp))) + -->
<!--   geom_line() + -->
<!--   labs(color = "country") -->
<!-- ``` -->
<!-- Sometimes you just want to hoist one or more levels to the front. Why? Because we said so. This resembles what we do when we move variables to the front with `dplyr::select(special_var, everything())`. -->
<!-- ```{r} -->
<!-- h_gap$country |>  -->
<!--   levels() -->
<!-- h_gap$country |>  -->
<!--   fct_relevel("Romania", "Haiti") |>  -->
<!--   levels() -->
<!-- ``` -->
<!-- This might be useful if you are preparing a report for, say, the Romanian government. The reason for always putting Romania first has nothing to do with the data, it is important for external reasons and you need a way to express this. -->
</section><section id="recode-the-levels" class="level3" data-number="2.4.3"><h3 data-number="2.4.3" class="anchored" data-anchor-id="recode-the-levels">
<span class="header-section-number">2.4.3</span> Recode the levels</h3>
<p>Use <code><a href="https://forcats.tidyverse.org/reference/fct_recode.html">fct_recode()</a></code> to change the names of the levels for a factor.</p>
<div class="cell">
<div class="sourceCode" id="cb92"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">i_gap</span> <span class="op">&lt;-</span> <span class="va">gapminder</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">country</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"United States"</span>, <span class="st">"Sweden"</span>, </span>
<span>                        <span class="st">"Australia"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/droplevels.html">droplevels</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">i_gap</span><span class="op">$</span><span class="va">country</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Australia"     "Sweden"        "United States"</code></pre>
</div>
<div class="sourceCode" id="cb94"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">i_gap</span><span class="op">$</span><span class="va">country</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_recode.html">fct_recode</a></span><span class="op">(</span><span class="st">"USA"</span> <span class="op">=</span> <span class="st">"United States"</span>, <span class="st">"Oz"</span> <span class="op">=</span> <span class="st">"Australia"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Oz"     "Sweden" "USA"   </code></pre>
</div>
</div>
</section></section><section id="date-times" class="level2" data-number="2.5"><h2 data-number="2.5" class="anchored" data-anchor-id="date-times">
<span class="header-section-number">2.5</span> Date-Times</h2>
<p>We will manipulate date-times using the <strong>lubridate</strong> package because lubridate makes it easier to work with dates and times in R. <strong>lubridate</strong> is not part of the core tidyverse because you only need it when you’re working with dates/times.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="https://imgs.xkcd.com/comics/iso_8601.png" class="img-fluid"></p>
</div>
</div>
<p>There are three types of date/time data that refer to an instant in time:</p>
<ul>
<li><p>A <code>date</code>. Tibbles print this as <code>&lt;date&gt;</code>.</p></li>
<li><p>A <code>time</code> within a day. Tibbles print this as <code>&lt;time&gt;</code>.</p></li>
<li><p>A <code>date-time</code> is a date plus a time. It uniquely identifies an instant in time (typically to the nearest second). Tibbles print this as <code>&lt;dttm&gt;</code>.</p></li>
</ul>
<p>You should always use the simplest possible data type that works for your needs. That means if you can use a date instead of a date-time, you should. Date-times are substantially more complicated because of the need to handle time zones, which we’ll come back to at the end of the chapter.</p>
<p>To get the current date or date-time you can use <code><a href="https://lubridate.tidyverse.org/reference/now.html">today()</a></code> or <code><a href="https://lubridate.tidyverse.org/reference/now.html">now()</a></code>:</p>
<div class="cell">
<div class="sourceCode" id="cb96"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/now.html">today</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2022-08-17"</code></pre>
</div>
<div class="sourceCode" id="cb98"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/now.html">now</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2022-08-17 11:25:34 EDT"</code></pre>
</div>
</div>
<p>Otherwise, there are three ways you’re likely to create a date/time:</p>
<ol type="1">
<li>From a string.</li>
<li>From individual date-time components.</li>
<li>From an existing date/time object.</li>
</ol>
<p>They work as follows:</p>
<section id="from-strings" class="level3" data-number="2.5.1"><h3 data-number="2.5.1" class="anchored" data-anchor-id="from-strings">
<span class="header-section-number">2.5.1</span> From strings</h3>
<p>Date/time data often comes as strings. The <strong>lubridate</strong> functions automatically work out the format once you specify the order of the component. First, figure out that you want the order in which year, month, and day appear in your dates, then arrange “y”, “m”, and “d” accordingly. That gives you the name of the <strong>lubridate</strong> function that will parse your date. For example:</p>
<div class="cell">
<div class="sourceCode" id="cb100"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html">ymd</a></span><span class="op">(</span><span class="st">"2017-01-31"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2017-01-31"</code></pre>
</div>
<div class="sourceCode" id="cb102"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html">mdy</a></span><span class="op">(</span><span class="st">"January 31st, 2017"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2017-01-31"</code></pre>
</div>
<div class="sourceCode" id="cb104"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html">dmy</a></span><span class="op">(</span><span class="st">"31-Jan-2017"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2017-01-31"</code></pre>
</div>
</div>
<p>These functions also take unquoted numbers. This is the most concise way to create a single date/time object, as you might need when filtering date/time data. <code><a href="https://lubridate.tidyverse.org/reference/ymd.html">ymd()</a></code> is short and unambiguous:</p>
<div class="cell">
<div class="sourceCode" id="cb106"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html">ymd</a></span><span class="op">(</span><span class="fl">20170131</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2017-01-31"</code></pre>
</div>
</div>
<p><code><a href="https://lubridate.tidyverse.org/reference/ymd.html">ymd()</a></code> and friends create dates. To create a date-time, add an underscore and one or more of “h”, “m”, and “s” to the name of the parsing function:</p>
<div class="cell">
<div class="sourceCode" id="cb108"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd_hms.html">ymd_hms</a></span><span class="op">(</span><span class="st">"2017-01-31 20:11:59"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2017-01-31 20:11:59 UTC"</code></pre>
</div>
<div class="sourceCode" id="cb110"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd_hms.html">mdy_hm</a></span><span class="op">(</span><span class="st">"01/31/2017 08:01"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2017-01-31 08:01:00 UTC"</code></pre>
</div>
</div>
<p>You can also force the creation of a date-time from a date by supplying a timezone:</p>
<div class="cell">
<div class="sourceCode" id="cb112"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html">ymd</a></span><span class="op">(</span><span class="fl">20170131</span>, tz <span class="op">=</span> <span class="st">"UTC"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2017-01-31 UTC"</code></pre>
</div>
</div>
</section><section id="from-individual-components" class="level3" data-number="2.5.2"><h3 data-number="2.5.2" class="anchored" data-anchor-id="from-individual-components">
<span class="header-section-number">2.5.2</span> From individual components</h3>
<p>Instead of a single string, sometimes you’ll have the individual components of the date-time spread across multiple columns. This is what we have in the flights data:</p>
<div class="cell">
<div class="sourceCode" id="cb114"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">flights</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">month</span>, <span class="va">day</span>, <span class="va">hour</span>, <span class="va">minute</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 336,776 × 5
    year month   day  hour minute
   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt;  &lt;dbl&gt;
 1  2013     1     1     5     15
 2  2013     1     1     5     29
 3  2013     1     1     5     40
 4  2013     1     1     5     45
 5  2013     1     1     6      0
 6  2013     1     1     5     58
 7  2013     1     1     6      0
 8  2013     1     1     6      0
 9  2013     1     1     6      0
10  2013     1     1     6      0
# … with 336,766 more rows
# ℹ Use `print(n = ...)` to see more rows</code></pre>
</div>
</div>
<p>To create a date/time from this sort of input, use <code><a href="https://lubridate.tidyverse.org/reference/make_datetime.html">make_date()</a></code> for dates, or <code><a href="https://lubridate.tidyverse.org/reference/make_datetime.html">make_datetime()</a></code> for date-times:</p>
<div class="cell">
<div class="sourceCode" id="cb116"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">flights</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">month</span>, <span class="va">day</span>, <span class="va">hour</span>, <span class="va">minute</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>departure <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/make_datetime.html">make_datetime</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">month</span>, <span class="va">day</span>, <span class="va">hour</span>, <span class="va">minute</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 336,776 × 6
    year month   day  hour minute departure          
   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dttm&gt;             
 1  2013     1     1     5     15 2013-01-01 05:15:00
 2  2013     1     1     5     29 2013-01-01 05:29:00
 3  2013     1     1     5     40 2013-01-01 05:40:00
 4  2013     1     1     5     45 2013-01-01 05:45:00
 5  2013     1     1     6      0 2013-01-01 06:00:00
 6  2013     1     1     5     58 2013-01-01 05:58:00
 7  2013     1     1     6      0 2013-01-01 06:00:00
 8  2013     1     1     6      0 2013-01-01 06:00:00
 9  2013     1     1     6      0 2013-01-01 06:00:00
10  2013     1     1     6      0 2013-01-01 06:00:00
# … with 336,766 more rows
# ℹ Use `print(n = ...)` to see more rows</code></pre>
</div>
</div>
</section><section id="from-other-types" class="level3" data-number="2.5.3"><h3 data-number="2.5.3" class="anchored" data-anchor-id="from-other-types">
<span class="header-section-number">2.5.3</span> From other types</h3>
<p>You may want to switch between a date-time and a date. That’s the job of <code><a href="https://lubridate.tidyverse.org/reference/as_date.html">as_datetime()</a></code> and <code><a href="https://lubridate.tidyverse.org/reference/as_date.html">as_date()</a></code>:</p>
<div class="cell">
<div class="sourceCode" id="cb118"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/as_date.html">as_datetime</a></span><span class="op">(</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/now.html">today</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2022-08-17 UTC"</code></pre>
</div>
<div class="sourceCode" id="cb120"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/as_date.html">as_date</a></span><span class="op">(</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/now.html">now</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2022-08-17"</code></pre>
</div>
</div>
<p>Sometimes you’ll get date/times as numeric offsets from the “Unix Epoch”, 1970-01-01. If the offset is in seconds, use <code><a href="https://lubridate.tidyverse.org/reference/as_date.html">as_datetime()</a></code>; if it’s in days, use <code><a href="https://lubridate.tidyverse.org/reference/as_date.html">as_date()</a></code>.</p>
<!-- Atilla: This section seems ambiguous. I feel like what the code below does and what the offset from "Unix Epoch" should be more clearly explained.-->
<div class="cell">
<div class="sourceCode" id="cb122"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/as_date.html">as_datetime</a></span><span class="op">(</span><span class="fl">60</span> <span class="op">*</span> <span class="fl">60</span> <span class="op">*</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "1970-01-01 10:00:00 UTC"</code></pre>
</div>
<div class="sourceCode" id="cb124"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/as_date.html">as_date</a></span><span class="op">(</span><span class="fl">365</span> <span class="op">*</span> <span class="fl">10</span> <span class="op">+</span> <span class="fl">2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "1980-01-01"</code></pre>
</div>
</div>
</section><section id="date-time-components" class="level3" data-number="2.5.4"><h3 data-number="2.5.4" class="anchored" data-anchor-id="date-time-components">
<span class="header-section-number">2.5.4</span> Date-time components</h3>
<p>Now that you know how to get date-time data into R’s date-time data structures, let’s explore what you can do with them. This section will focus on the accessor functions that let you get and set individual components. The next section will look at how arithmetic works with date-times.</p>
<p>You can pull out individual parts of the date with the accessor functions <code><a href="https://lubridate.tidyverse.org/reference/year.html">year()</a></code>, <code><a href="https://lubridate.tidyverse.org/reference/month.html">month()</a></code>, <code><a href="https://lubridate.tidyverse.org/reference/day.html">mday()</a></code> (day of the month), <code><a href="https://lubridate.tidyverse.org/reference/day.html">yday()</a></code> (day of the year), <code><a href="https://lubridate.tidyverse.org/reference/day.html">wday()</a></code> (day of the week), <code><a href="https://lubridate.tidyverse.org/reference/hour.html">hour()</a></code>, <code><a href="https://lubridate.tidyverse.org/reference/minute.html">minute()</a></code>, and <code><a href="https://lubridate.tidyverse.org/reference/second.html">second()</a></code>.</p>
<div class="cell">
<div class="sourceCode" id="cb126"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">datetime</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd_hms.html">ymd_hms</a></span><span class="op">(</span><span class="st">"2016-07-08 12:34:56"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/year.html">year</a></span><span class="op">(</span><span class="va">datetime</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2016</code></pre>
</div>
<div class="sourceCode" id="cb128"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/month.html">month</a></span><span class="op">(</span><span class="va">datetime</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 7</code></pre>
</div>
<div class="sourceCode" id="cb130"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/day.html">mday</a></span><span class="op">(</span><span class="va">datetime</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 8</code></pre>
</div>
<div class="sourceCode" id="cb132"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/day.html">yday</a></span><span class="op">(</span><span class="va">datetime</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 190</code></pre>
</div>
<div class="sourceCode" id="cb134"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/day.html">wday</a></span><span class="op">(</span><span class="va">datetime</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 6</code></pre>
</div>
</div>
<p>For <code><a href="https://lubridate.tidyverse.org/reference/month.html">month()</a></code> and <code><a href="https://lubridate.tidyverse.org/reference/day.html">wday()</a></code> you can set <code>label = TRUE</code> to return the abbreviated name of the month or day of the week. Set both <code>label = TRUE</code> and <code>abbr = FALSE</code> to return the full name.</p>
<div class="cell">
<div class="sourceCode" id="cb136"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/month.html">month</a></span><span class="op">(</span><span class="va">datetime</span>, label <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] Jul
12 Levels: Jan &lt; Feb &lt; Mar &lt; Apr &lt; May &lt; Jun &lt; Jul &lt; Aug &lt; Sep &lt; ... &lt; Dec</code></pre>
</div>
<div class="sourceCode" id="cb138"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/day.html">wday</a></span><span class="op">(</span><span class="va">datetime</span>, label <span class="op">=</span> <span class="cn">TRUE</span>, abbr <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] Friday
7 Levels: Sunday &lt; Monday &lt; Tuesday &lt; Wednesday &lt; Thursday &lt; ... &lt; Saturday</code></pre>
</div>
</div>
</section><section id="setting-components" class="level3" data-number="2.5.5"><h3 data-number="2.5.5" class="anchored" data-anchor-id="setting-components">
<span class="header-section-number">2.5.5</span> Setting components</h3>
<p>You can create a new date-time with <code><a href="https://rdrr.io/r/stats/update.html">update()</a></code>.</p>
<div class="cell">
<div class="sourceCode" id="cb140"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/update.html">update</a></span><span class="op">(</span><span class="va">datetime</span>, year <span class="op">=</span> <span class="fl">2020</span>, month <span class="op">=</span> <span class="fl">2</span>, mday <span class="op">=</span> <span class="fl">2</span>, hour <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2020-02-02 02:34:56 UTC"</code></pre>
</div>
</div>
<p>If values are too big, they will roll-over:</p>
<div class="cell">
<div class="sourceCode" id="cb142"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html">ymd</a></span><span class="op">(</span><span class="st">"2015-02-01"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/update.html">update</a></span><span class="op">(</span>mday <span class="op">=</span> <span class="fl">30</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2015-03-02"</code></pre>
</div>
<div class="sourceCode" id="cb144"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html">ymd</a></span><span class="op">(</span><span class="st">"2015-02-01"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/update.html">update</a></span><span class="op">(</span>hour <span class="op">=</span> <span class="fl">400</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2015-02-17 16:00:00 UTC"</code></pre>
</div>
</div>
</section><section id="time-zones" class="level3" data-number="2.5.6"><h3 data-number="2.5.6" class="anchored" data-anchor-id="time-zones">
<span class="header-section-number">2.5.6</span> Time zones</h3>
<p>Time zones are an enormously complicated topic because of their interaction with geopolitical entities. Fortunately, we don’t need to dig into all the details as they’re not all imperative for data analysis. You can see the complete list of possible timezones with the function <code><a href="https://rdrr.io/r/base/timezones.html">OlsonNames()</a></code>. Unless otherwise specified, <strong>lubridate</strong> always uses UTC (Coordinated Universal Time).</p>
<p>In R, the time zone is an attribute of the date-time that only controls printing. For example, these three objects represent the same instant in time:</p>
<div class="cell">
<div class="sourceCode" id="cb146"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="op">(</span><span class="va">x1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd_hms.html">ymd_hms</a></span><span class="op">(</span><span class="st">"2015-06-01 12:00:00"</span>, tz <span class="op">=</span> <span class="st">"America/New_York"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2015-06-01 12:00:00 EDT"</code></pre>
</div>
<div class="sourceCode" id="cb148"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="op">(</span><span class="va">x2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd_hms.html">ymd_hms</a></span><span class="op">(</span><span class="st">"2015-06-01 18:00:00"</span>, tz <span class="op">=</span> <span class="st">"Europe/Copenhagen"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2015-06-01 18:00:00 CEST"</code></pre>
</div>
<div class="sourceCode" id="cb150"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="op">(</span><span class="va">x3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd_hms.html">ymd_hms</a></span><span class="op">(</span><span class="st">"2015-06-02 04:00:00"</span>, tz <span class="op">=</span> <span class="st">"Pacific/Auckland"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2015-06-02 04:00:00 NZST"</code></pre>
</div>
</div>
</section></section><section id="combining-data" class="level2" data-number="2.6"><h2 data-number="2.6" class="anchored" data-anchor-id="combining-data">
<span class="header-section-number">2.6</span> Combining Data</h2>
<p>There are many ways to bring data together.</p>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="02-wrangling/images/wrangling.gif" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Combining data is often tricky.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>The <code><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows()</a></code> function is used to combine all the rows from two or more tibbles.</p>
<div class="cell">
<div class="sourceCode" id="cb152"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">data_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span>,                </span>
<span>                 y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"B"</span><span class="op">)</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">data_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">3</span><span class="op">:</span><span class="fl">4</span>,</span>
<span>                 y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"C"</span>, <span class="st">"D"</span><span class="op">)</span><span class="op">)</span> </span>
<span></span>
<span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows</a></span><span class="op">(</span><span class="va">data_1</span>, <span class="va">data_2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 2
      x y    
  &lt;int&gt; &lt;chr&gt;
1     1 A    
2     2 B    
3     3 C    
4     4 D    </code></pre>
</div>
</div>
<section id="joins" class="level3" data-number="2.6.1"><h3 data-number="2.6.1" class="anchored" data-anchor-id="joins">
<span class="header-section-number">2.6.1</span> Joins</h3>
<p>Consider two tibbles: <code>superheroes</code> and <code>publishers</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb154"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">superheroes</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html">tribble</a></span><span class="op">(</span></span>
<span>       <span class="op">~</span><span class="va">name</span>,   <span class="op">~</span><span class="va">gender</span>,     <span class="op">~</span><span class="va">publisher</span>,</span>
<span>   <span class="st">"Magneto"</span>,   <span class="st">"male"</span>,       <span class="st">"Marvel"</span>,</span>
<span>     <span class="st">"Storm"</span>,   <span class="st">"female"</span>,     <span class="st">"Marvel"</span>,</span>
<span>    <span class="st">"Batman"</span>,   <span class="st">"male"</span>,       <span class="st">"DC"</span>,</span>
<span>  <span class="st">"Catwoman"</span>,   <span class="st">"female"</span>,     <span class="st">"DC"</span>,</span>
<span>   <span class="st">"Hellboy"</span>,   <span class="st">"male"</span>,       <span class="st">"Dark Horse Comics"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">publishers</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html">tribble</a></span><span class="op">(</span></span>
<span>  <span class="op">~</span><span class="va">publisher</span>, <span class="op">~</span><span class="va">yr_founded</span>,</span>
<span>        <span class="st">"DC"</span>,       <span class="fl">1934L</span>,</span>
<span>    <span class="st">"Marvel"</span>,       <span class="fl">1939L</span>,</span>
<span>     <span class="st">"Image"</span>,       <span class="fl">1992L</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note how easy it is to use <code><a href="https://tibble.tidyverse.org/reference/tribble.html">tribble()</a></code> from the <strong>tibble</strong> package to create a tibble on the fly using text which organized for easy entry and reading. Recall that a double colon — <code>::</code> — is how we indicate that a function comes from a specific package.</p>
<section id="inner_join" class="level4" data-number="2.6.1.1"><h4 data-number="2.6.1.1" class="anchored" data-anchor-id="inner_join">
<span class="header-section-number">2.6.1.1</span> <code>inner_join()</code>
</h4>
<!-- Instead show a diagram of left_join() and briefly cover the rest of the joins, as left_join() is by far the most commonly-used join method. -->
<p><code>inner_join(x, y)</code>: Returns all rows from <code>x</code> where there are matching values in <code>y</code>, and all columns from <code>x</code> and <code>y</code>. If there are multiple matches between <code>x</code> and <code>y</code>, all combination of the matches are returned.</p>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="02-wrangling/images/join-inner.png" class="img-fluid figure-img" width="338"></p>
<p></p><figcaption class="figure-caption">Inner join.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb155"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join</a></span><span class="op">(</span><span class="va">superheroes</span>, <span class="va">publishers</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining, by = "publisher"</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 4
  name     gender publisher yr_founded
  &lt;chr&gt;    &lt;chr&gt;  &lt;chr&gt;          &lt;int&gt;
1 Magneto  male   Marvel          1939
2 Storm    female Marvel          1939
3 Batman   male   DC              1934
4 Catwoman female DC              1934</code></pre>
</div>
</div>
<p>We lose Hellboy in the join because, although he appears in <code>x = superheroes</code>, his publisher Dark Horse Comics does not appear in <code>y = publishers</code>. The join result has all variables from <code>x = superheroes</code> plus <code>yr_founded</code>, from <code>y</code>.</p>
<p>Note the message that we are ‘Joining, by = “publisher”’. Whenever joining, R checks to see if there are variables in common between the two tibbles and, if there are, uses them to join. However, it is concerned that you may not be aware that this is what it is doing, so R tells you. Such messages are both annoying and a signal that we have not made our code as robust as we should. Fortunately, we can specify precisely which variables we want to join by. Always do this.</p>
<div class="cell">
<div class="sourceCode" id="cb158"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join</a></span><span class="op">(</span><span class="va">superheroes</span>, <span class="va">publishers</span>, by <span class="op">=</span> <span class="st">"publisher"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>by</code> also takes a vector of key variables if you want to merge by multiple variables.</p>
<p>Now compare this result to that of using <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join()</a></code> with the two datasets in opposite positions.</p>
<div class="cell">
<div class="sourceCode" id="cb159"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join</a></span><span class="op">(</span><span class="va">publishers</span>, <span class="va">superheroes</span>, by <span class="op">=</span> <span class="st">"publisher"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 4
  publisher yr_founded name     gender
  &lt;chr&gt;          &lt;int&gt; &lt;chr&gt;    &lt;chr&gt; 
1 DC              1934 Batman   male  
2 DC              1934 Catwoman female
3 Marvel          1939 Magneto  male  
4 Marvel          1939 Storm    female</code></pre>
</div>
</div>
<p>In a way, this does illustrate multiple matches, if you think about it from the <code>x = publishers</code> direction. Every publisher that has a match in <code>y = superheroes</code> appears multiple times in the result, once for each match. In fact, we’re getting the same result as with <code>inner_join(superheroes, publishers)</code>, up to variable order (which you should also never rely on in an analysis).</p>
</section><section id="full_join" class="level4" data-number="2.6.1.2"><h4 data-number="2.6.1.2" class="anchored" data-anchor-id="full_join">
<span class="header-section-number">2.6.1.2</span> <code>full_join()</code>
</h4>
<p><code>full_join(x, y)</code>: Returns all rows and all columns from both <code>x</code> and <code>y</code>. Where there are not matching values, returns <code>NA</code> for the one missing.</p>
<div class="cell">
<div class="sourceCode" id="cb161"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">full_join</a></span><span class="op">(</span><span class="va">superheroes</span>, <span class="va">publishers</span>, by <span class="op">=</span> <span class="st">"publisher"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 4
  name     gender publisher         yr_founded
  &lt;chr&gt;    &lt;chr&gt;  &lt;chr&gt;                  &lt;int&gt;
1 Magneto  male   Marvel                  1939
2 Storm    female Marvel                  1939
3 Batman   male   DC                      1934
4 Catwoman female DC                      1934
5 Hellboy  male   Dark Horse Comics         NA
6 &lt;NA&gt;     &lt;NA&gt;   Image                   1992</code></pre>
</div>
</div>
<p>We get all rows of <code>x = superheroes</code> plus a new row from <code>y = publishers</code>, containing the publisher Image. We get all variables from <code>x = superheroes</code> AND all variables from <code>y = publishers</code>. Any row that derives solely from one table or the other carries <code>NA</code>s in the variables found only in the other table.</p>
<p>Because <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">full_join()</a></code> returns all rows and all columns from both <code>x</code> and <code>y</code>, the result of <code>full_join(x = superheroes, y = publishers)</code> should match that of <code>full_join(x = publishers, y = superheroes)</code>.</p>
</section><section id="left_join" class="level4" data-number="2.6.1.3"><h4 data-number="2.6.1.3" class="anchored" data-anchor-id="left_join">
<span class="header-section-number">2.6.1.3</span> <code>left_join()</code>
</h4>
<p><code>left_join(x, y)</code>: Returns all rows from <code>x</code>, and all columns from <code>x</code> and <code>y</code>. If there are multiple matches between <code>x</code> and <code>y</code>, all combination of the matches are returned.</p>
<div class="cell">
<div class="sourceCode" id="cb163"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">superheroes</span>, <span class="va">publishers</span>, by <span class="op">=</span> <span class="st">"publisher"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 4
  name     gender publisher         yr_founded
  &lt;chr&gt;    &lt;chr&gt;  &lt;chr&gt;                  &lt;int&gt;
1 Magneto  male   Marvel                  1939
2 Storm    female Marvel                  1939
3 Batman   male   DC                      1934
4 Catwoman female DC                      1934
5 Hellboy  male   Dark Horse Comics         NA</code></pre>
</div>
</div>
<p>We basically get <code>x = superheroes</code> back, but with an additional variable <code>yr_founded</code>, which is unique to <code>y = publishers</code>. Hellboy, whose publisher does not appear in <code>y = publishers</code>, has an <code>NA</code> for <code>yr_founded</code>.</p>
<p>Now compare this result to that of running <code>left_join(x = publishers, y = superheroes)</code>. Unlike <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join()</a></code> and <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">full_join()</a></code> the order of the arguments has a significant effect on the resulting tibble.</p>
<div class="cell">
<div class="sourceCode" id="cb165"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">publishers</span>, <span class="va">superheroes</span>, by <span class="op">=</span> <span class="st">"publisher"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 4
  publisher yr_founded name     gender
  &lt;chr&gt;          &lt;int&gt; &lt;chr&gt;    &lt;chr&gt; 
1 DC              1934 Batman   male  
2 DC              1934 Catwoman female
3 Marvel          1939 Magneto  male  
4 Marvel          1939 Storm    female
5 Image           1992 &lt;NA&gt;     &lt;NA&gt;  </code></pre>
</div>
</div>
<p>We get a similar result as with <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join()</a></code>, but the publisher Image survives in the join, even though no superheroes from Image appear in <code>y = superheroes</code>. As a result, Image has <code>NA</code>s for <code>name</code> and <code>gender</code>.</p>
<p>There is a similar function, <code>right_join(x, y)</code> that returns all rows from <code>y</code>, and all columns from <code>x</code> and <code>y</code>.</p>
</section><section id="semi_join" class="level4" data-number="2.6.1.4"><h4 data-number="2.6.1.4" class="anchored" data-anchor-id="semi_join">
<span class="header-section-number">2.6.1.4</span> <code>semi_join()</code>
</h4>
<p><code>semi_join(x, y)</code>: Returns all rows from <code>x</code> where there are matching values in <code>y</code>, keeping just columns from <code>x</code>. A semi join differs from an inner join because an inner join will return one row of <code>x</code> for each matching row of <code>y</code>, whereas a semi join will never duplicate rows of <code>x</code>. This is a filtering join.</p>
<div class="cell">
<div class="sourceCode" id="cb167"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter-joins.html">semi_join</a></span><span class="op">(</span><span class="va">superheroes</span>, <span class="va">publishers</span>, by <span class="op">=</span> <span class="st">"publisher"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 3
  name     gender publisher
  &lt;chr&gt;    &lt;chr&gt;  &lt;chr&gt;    
1 Magneto  male   Marvel   
2 Storm    female Marvel   
3 Batman   male   DC       
4 Catwoman female DC       </code></pre>
</div>
</div>
<p>Compare the result of switching the values of the arguments.</p>
<div class="cell">
<div class="sourceCode" id="cb169"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter-joins.html">semi_join</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">publishers</span>, y <span class="op">=</span> <span class="va">superheroes</span>, by <span class="op">=</span> <span class="st">"publisher"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 2
  publisher yr_founded
  &lt;chr&gt;          &lt;int&gt;
1 DC              1934
2 Marvel          1939</code></pre>
</div>
</div>
<p>Now the effects of switching the <code>x</code> and <code>y</code> roles is more clear. The result resembles <code>x = publishers</code>, but the publisher Image is lost, since there are no observations where <code>publisher == "Image"</code> in <code>y = superheroes</code>.</p>
</section><section id="anti_join" class="level4" data-number="2.6.1.5"><h4 data-number="2.6.1.5" class="anchored" data-anchor-id="anti_join">
<span class="header-section-number">2.6.1.5</span> <code>anti_join()</code>
</h4>
<p><code>anti_join(x, y)</code>: Return all rows from <code>x</code> where there are no matching values in <code>y</code>, keeping just columns from <code>x</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb171"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter-joins.html">anti_join</a></span><span class="op">(</span><span class="va">superheroes</span>, <span class="va">publishers</span>, by <span class="op">=</span> <span class="st">"publisher"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 3
  name    gender publisher        
  &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;            
1 Hellboy male   Dark Horse Comics</code></pre>
</div>
</div>
<p>We keep only Hellboy now.</p>
<p>Now switch the arguments and compare the result.</p>
<div class="cell">
<div class="sourceCode" id="cb173"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter-joins.html">anti_join</a></span><span class="op">(</span><span class="va">publishers</span>, <span class="va">superheroes</span>, by <span class="op">=</span> <span class="st">"publisher"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 2
  publisher yr_founded
  &lt;chr&gt;          &lt;int&gt;
1 Image           1992</code></pre>
</div>
</div>
<p>We keep only publisher Image now (and the variables found in <code>x = publishers</code>).</p>
</section></section><section id="example" class="level3" data-number="2.6.2"><h3 data-number="2.6.2" class="anchored" data-anchor-id="example">
<span class="header-section-number">2.6.2</span> Example</h3>
<p>Consider the relationships among the tibbles in the <strong>nycflights13</strong> package:</p>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="02-wrangling/images/relational-nycflights.png" class="img-fluid figure-img" width="396"></p>
<p></p><figcaption class="figure-caption">Relationships among nycflights tables</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>In both the <code>flights</code> and <code>airlines</code> data frames, the key variable we want to join/merge/match the rows by has the same name: <code>carrier</code>. Let’s use <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join()</a></code> to join the two data frames, where the rows will be matched by the variable <code>carrier</code></p>
<div class="cell">
<div class="sourceCode" id="cb175"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">flights</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join</a></span><span class="op">(</span><span class="va">airlines</span>, by <span class="op">=</span> <span class="st">"carrier"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 336,776 × 20
    year month   day dep_time sched_de…¹ dep_d…² arr_t…³ sched…⁴ arr_d…⁵ carrier
   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;      &lt;int&gt;   &lt;dbl&gt;   &lt;int&gt;   &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;  
 1  2013     1     1      517        515       2     830     819      11 UA     
 2  2013     1     1      533        529       4     850     830      20 UA     
 3  2013     1     1      542        540       2     923     850      33 AA     
 4  2013     1     1      544        545      -1    1004    1022     -18 B6     
 5  2013     1     1      554        600      -6     812     837     -25 DL     
 6  2013     1     1      554        558      -4     740     728      12 UA     
 7  2013     1     1      555        600      -5     913     854      19 B6     
 8  2013     1     1      557        600      -3     709     723     -14 EV     
 9  2013     1     1      557        600      -3     838     846      -8 B6     
10  2013     1     1      558        600      -2     753     745       8 AA     
# … with 336,766 more rows, 10 more variables: flight &lt;int&gt;, tailnum &lt;chr&gt;,
#   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
#   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;, name &lt;chr&gt;, and abbreviated variable names
#   ¹​sched_dep_time, ²​dep_delay, ³​arr_time, ⁴​sched_arr_time, ⁵​arr_delay
# ℹ Use `print(n = ...)` to see more rows, and `colnames()` to see all variable names</code></pre>
</div>
</div>
<p>This is our first example of using a join function with a “pipe.” <code>flights</code> is fed as the first argument to <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join()</a></code>. That is what the pipe does. The symbol is created by combining a vertical line <code>|</code> and a greater-than symbol ‘&gt;’. Cmd-Shift-M is the shortcut key for inserting a pipe.</p>
<p>The above code is equivalent to:</p>
<div class="cell">
<div class="sourceCode" id="cb177"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join</a></span><span class="op">(</span><span class="va">flights</span>, <span class="va">airlines</span>, by <span class="op">=</span> <span class="st">"carrier"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <code>airports</code> data frame contains the airport codes for each airport:</p>
<div class="cell">
<div class="sourceCode" id="cb178"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">airports</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1,458 × 8
   faa   name                             lat    lon   alt    tz dst   tzone    
   &lt;chr&gt; &lt;chr&gt;                          &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;    
 1 04G   Lansdowne Airport               41.1  -80.6  1044    -5 A     America/…
 2 06A   Moton Field Municipal Airport   32.5  -85.7   264    -6 A     America/…
 3 06C   Schaumburg Regional             42.0  -88.1   801    -6 A     America/…
 4 06N   Randall Airport                 41.4  -74.4   523    -5 A     America/…
 5 09J   Jekyll Island Airport           31.1  -81.4    11    -5 A     America/…
 6 0A9   Elizabethton Municipal Airport  36.4  -82.2  1593    -5 A     America/…
 7 0G6   Williams County Airport         41.5  -84.5   730    -5 A     America/…
 8 0G7   Finger Lakes Regional Airport   42.9  -76.8   492    -5 A     America/…
 9 0P2   Shoestring Aviation Airfield    39.8  -76.6  1000    -5 U     America/…
10 0S9   Jefferson County Intl           48.1 -123.    108    -8 A     America/…
# … with 1,448 more rows
# ℹ Use `print(n = ...)` to see more rows</code></pre>
</div>
</div>
<p>However, if you look at both the <code>airports</code> and <code>flights</code> data frames, you’ll find that the airport codes are in variables that have different names. In <code>airports</code> the airport code is in <code>faa</code>, whereas in <code>flights</code> the airport codes are in <code>origin</code> and <code>dest</code>.</p>
<p>In order to join these two data frames by airport code, our <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join()</a></code> operation will use <code>by = c("dest" = "faa")</code> thereby allowing us to join two data frames where the key variable has a different name.</p>
<div class="cell">
<div class="sourceCode" id="cb180"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">flights</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join</a></span><span class="op">(</span><span class="va">airports</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"dest"</span> <span class="op">=</span> <span class="st">"faa"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 329,174 × 26
    year month   day dep_time sched_de…¹ dep_d…² arr_t…³ sched…⁴ arr_d…⁵ carrier
   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;      &lt;int&gt;   &lt;dbl&gt;   &lt;int&gt;   &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;  
 1  2013     1     1      517        515       2     830     819      11 UA     
 2  2013     1     1      533        529       4     850     830      20 UA     
 3  2013     1     1      542        540       2     923     850      33 AA     
 4  2013     1     1      554        600      -6     812     837     -25 DL     
 5  2013     1     1      554        558      -4     740     728      12 UA     
 6  2013     1     1      555        600      -5     913     854      19 B6     
 7  2013     1     1      557        600      -3     709     723     -14 EV     
 8  2013     1     1      557        600      -3     838     846      -8 B6     
 9  2013     1     1      558        600      -2     753     745       8 AA     
10  2013     1     1      558        600      -2     849     851      -2 B6     
# … with 329,164 more rows, 16 more variables: flight &lt;int&gt;, tailnum &lt;chr&gt;,
#   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
#   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;, name &lt;chr&gt;, lat &lt;dbl&gt;, lon &lt;dbl&gt;,
#   alt &lt;dbl&gt;, tz &lt;dbl&gt;, dst &lt;chr&gt;, tzone &lt;chr&gt;, and abbreviated variable names
#   ¹​sched_dep_time, ²​dep_delay, ³​arr_time, ⁴​sched_arr_time, ⁵​arr_delay
# ℹ Use `print(n = ...)` to see more rows, and `colnames()` to see all variable names</code></pre>
</div>
</div>
<p>Let’s construct the chain of pipe operators <code>|&gt;</code> that computes the number of flights from NYC to each destination, but also includes information about each destination airport:</p>
<div class="cell">
<div class="sourceCode" id="cb182"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">flights</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">dest</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>num_flights <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>            .groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html">desc</a></span><span class="op">(</span><span class="va">num_flights</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join</a></span><span class="op">(</span><span class="va">airports</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"dest"</span> <span class="op">=</span> <span class="st">"faa"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>airport_name <span class="op">=</span> <span class="va">name</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 101 × 9
   dest  num_flights airport_name             lat    lon   alt    tz dst   tzone
   &lt;chr&gt;       &lt;int&gt; &lt;chr&gt;                  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;
 1 ORD         17283 Chicago Ohare Intl      42.0  -87.9   668    -6 A     Amer…
 2 ATL         17215 Hartsfield Jackson At…  33.6  -84.4  1026    -5 A     Amer…
 3 LAX         16174 Los Angeles Intl        33.9 -118.    126    -8 A     Amer…
 4 BOS         15508 General Edward Lawren…  42.4  -71.0    19    -5 A     Amer…
 5 MCO         14082 Orlando Intl            28.4  -81.3    96    -5 A     Amer…
 6 CLT         14064 Charlotte Douglas Intl  35.2  -80.9   748    -5 A     Amer…
 7 SFO         13331 San Francisco Intl      37.6 -122.     13    -8 A     Amer…
 8 FLL         12055 Fort Lauderdale Holly…  26.1  -80.2     9    -5 A     Amer…
 9 MIA         11728 Miami Intl              25.8  -80.3     8    -5 A     Amer…
10 DCA          9705 Ronald Reagan Washing…  38.9  -77.0    15    -5 A     Amer…
# … with 91 more rows
# ℹ Use `print(n = ...)` to see more rows</code></pre>
</div>
</div>
<p><code>"ORD"</code> is the airport code of Chicago O’Hare airport and <code>"FLL"</code> is the code for the main airport in Fort Lauderdale, Florida, which can be seen in the <code>airport_name</code> variable.</p>
</section></section><section id="tidy-data" class="level2" data-number="2.7"><h2 data-number="2.7" class="anchored" data-anchor-id="tidy-data">
<span class="header-section-number">2.7</span> Tidy data</h2>
<p>Consider the first five rows from the <code>drinks</code> data frame from the <strong>fivethirtyeight</strong> package:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 5
  country     beer_servings spirit_servings wine_servings total_litres_of_pure…¹
  &lt;chr&gt;               &lt;int&gt;           &lt;int&gt;         &lt;int&gt;                  &lt;dbl&gt;
1 Afghanistan             0               0             0                    0  
2 Albania                89             132            54                    4.9
3 Algeria                25               0            14                    0.7
4 Andorra               245             138           312                   12.4
5 Angola                217              57            45                    5.9
# … with abbreviated variable name ¹​total_litres_of_pure_alcohol</code></pre>
</div>
</div>
<p>After reading the help file by running <code><a href="https://rdrr.io/pkg/fivethirtyeight/man/drinks.html">?drinks</a></code>, you’ll see that <code>drinks</code> is a data frame that contains the results from a survey of the average number of servings of beer, spirits, and wine consumed in 193 countries. This data was originally reported on FiveThirtyEight.com in Mona Chalabi’s article: <a href="https://fivethirtyeight.com/features/dear-mona-followup-where-do-people-drink-the-most-beer-wine-and-spirits/">“Dear Mona Followup: Where Do People Drink The Most Beer, Wine And Spirits?”</a>.</p>
<p>Let’s apply some of the data wrangling verbs on the <code>drinks</code> data frame:</p>
<ol type="1">
<li>
<code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> the <code>drinks</code> data frame to only consider 4 countries: the United States, China, Italy, and Saudi Arabia, <em>then</em>
</li>
<li>
<code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code> all columns except <code>total_litres_of_pure_alcohol</code> by using the <code>-</code> sign, <em>then</em>
</li>
<li>
<code><a href="https://dplyr.tidyverse.org/reference/rename.html">rename()</a></code> the variables <code>beer_servings</code>, <code>spirit_servings</code>, and <code>wine_servings</code> to <code>beer</code>, <code>spirit</code>, and <code>wine</code>, respectively.</li>
</ol>
<p>We will save the resulting data frame in <code>drinks_smaller</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb185"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">drinks_smaller</span> <span class="op">&lt;-</span> <span class="va">drinks</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">country</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"USA"</span>, <span class="st">"China"</span>, <span class="st">"Italy"</span>, <span class="st">"Saudi Arabia"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">total_litres_of_pure_alcohol</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>beer <span class="op">=</span> <span class="va">beer_servings</span>, spirit <span class="op">=</span> <span class="va">spirit_servings</span>, wine <span class="op">=</span> <span class="va">wine_servings</span><span class="op">)</span></span>
<span><span class="va">drinks_smaller</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 4
  country       beer spirit  wine
  &lt;chr&gt;        &lt;int&gt;  &lt;int&gt; &lt;int&gt;
1 China           79    192     8
2 Italy           85     42   237
3 Saudi Arabia     0      5     0
4 USA            249    158    84</code></pre>
</div>
</div>
<section id="definition-of-tidy-data" class="level3" data-number="2.7.1"><h3 data-number="2.7.1" class="anchored" data-anchor-id="definition-of-tidy-data">
<span class="header-section-number">2.7.1</span> Definition of “tidy” data</h3>
<p>What does it mean for your data to be “tidy”? While “tidy” has a clear English meaning of “organized,” the word “tidy” in data science using R means that your data follows a standardized format.</p>
<p>“Tidy” data is a standard way of mapping the meaning of a dataset to its structure. A dataset is messy or tidy depending on how rows, columns and tables are matched up with observations, variables and types. In <em>tidy data</em>:</p>
<ol type="1">
<li>Each variable forms a column.</li>
<li>Each observation forms a row.</li>
<li>Each type of observational unit forms a table.</li>
</ol>
<div class="cell">
<div class="cell-output-display">
<p><img src="02-wrangling/images/tidy-1.png" class="img-fluid" width="960"></p>
</div>
</div>
</section><section id="converting-to-tidy-data" class="level3" data-number="2.7.2"><h3 data-number="2.7.2" class="anchored" data-anchor-id="converting-to-tidy-data">
<span class="header-section-number">2.7.2</span> Converting to “tidy” data</h3>
<p>In this book so far, you’ve only seen data frames that were already in “tidy” format. Furthermore, for the rest of this book, you’ll mostly only see data frames that are already tidy as well. This is not always the case, however, with all datasets in the world. If your original data frame is in wide (non-“tidy”) format and you would like to use the <strong>ggplot2</strong> or <strong>dplyr</strong> packages, you will first have to convert it to “tidy” format. To do so, we recommend using the <code><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer()</a></code> function in the <strong>tidyr</strong> package <span class="citation" data-cites="R-tidyr">(<a href="references.html#ref-R-tidyr" role="doc-biblioref">Wickham and Girlich 2022</a>)</span>.</p>
<p>Going back to our <code>drinks_smaller</code> data frame from earlier:</p>
<div class="cell">
<div class="sourceCode" id="cb187"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">drinks_smaller</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 4
  country       beer spirit  wine
  &lt;chr&gt;        &lt;int&gt;  &lt;int&gt; &lt;int&gt;
1 China           79    192     8
2 Italy           85     42   237
3 Saudi Arabia     0      5     0
4 USA            249    158    84</code></pre>
</div>
</div>
<p>We tidy it by using the <code><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer()</a></code> function from the <strong>tidyr</strong> package as follows:</p>
<div class="cell">
<div class="sourceCode" id="cb189"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">drinks_smaller_tidy</span> <span class="op">&lt;-</span> <span class="va">drinks_smaller</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span>names_to <span class="op">=</span> <span class="st">"type"</span>, </span>
<span>               values_to <span class="op">=</span> <span class="st">"servings"</span>, </span>
<span>               cols <span class="op">=</span> <span class="op">-</span><span class="va">country</span><span class="op">)</span></span>
<span><span class="va">drinks_smaller_tidy</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 12 × 3
   country      type   servings
   &lt;chr&gt;        &lt;chr&gt;     &lt;int&gt;
 1 China        beer         79
 2 China        spirit      192
 3 China        wine          8
 4 Italy        beer         85
 5 Italy        spirit       42
 6 Italy        wine        237
 7 Saudi Arabia beer          0
 8 Saudi Arabia spirit        5
 9 Saudi Arabia wine          0
10 USA          beer        249
11 USA          spirit      158
12 USA          wine         84</code></pre>
</div>
</div>
<p>Let’s dissect the arguments to <code><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer()</a></code>.</p>
<ol type="1">
<li><p>the first argument<code>names_to</code> corresponds to the name of the variable in the new “tidy”/long data frame that will contain the <em>column names</em> of the original data. Observe how we set <code>names_to = "type"</code>. In the resulting <code>drinks_smaller_tidy</code>, the column <code>type</code> contains the three types of alcohol <code>beer</code>, <code>spirit</code>, and <code>wine</code>. Since <code>type</code> is a variable name that doesn’t appear in <code>drinks_smaller</code>, we use quotation marks around it. You’ll receive an error if you just use <code>names_to = type</code> here.</p></li>
<li><p>The second argument <code>values_to</code> corresponds to the name of the variable in the new “tidy” data frame that will contain the <em>values</em> of the original data. Observe how we set <code>values_to = "servings"</code> since each numeric value in the <code>beer</code>, <code>wine</code>, and <code>spirit</code> columns of the <code>drinks_smaller</code> corresponds to a value of <code>servings</code>. In the resulting <code>drinks_smaller_tidy</code>, the column <code>servings</code> contains the 4 <span class="math inline">\(\times\)</span> 3 = 12 numerical values. Note again that <code>servings</code> doesn’t appear as a variable in <code>drinks_smaller</code> so it again needs quotation marks around it for the <code>values_to</code> argument.</p></li>
<li><p>The third argument <code>cols</code> is the columns in the <code>drinks_smaller</code> data frame you either want to or don’t want to “tidy.” Observe how we set this to <code>-country</code> indicating that we don’t want to “tidy” the <code>country</code> variable in <code>drinks_smaller</code> and rather only <code>beer</code>, <code>spirit</code>, and <code>wine</code>. Since <code>country</code> is a column that appears in <code>drinks_smaller</code> we don’t put quotation marks around it.</p></li>
</ol>
<p>The third argument here of <code>cols</code> is a little nuanced, so let’s consider code that was written slightly differently but that produces the same output:</p>
<div class="cell">
<div class="sourceCode" id="cb191"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">drinks_smaller</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span>names_to <span class="op">=</span> <span class="st">"type"</span>, </span>
<span>               values_to <span class="op">=</span> <span class="st">"servings"</span>, </span>
<span>               cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">beer</span>, <span class="va">spirit</span>, <span class="va">wine</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note that the third argument now specifies which columns we want to “tidy” with <code>c(beer, spirit, wine)</code>, instead of the columns we don’t want to “tidy” using <code>-country</code>. We use the <code><a href="https://rdrr.io/r/base/c.html">c()</a></code> function to create a vector of the columns in <code>drinks_smaller</code> that we’d like to “tidy.” Note that since these three columns appear one after another in the <code>drinks_smaller</code> data frame, we can also do the following for the <code>cols</code> argument:</p>
<div class="cell">
<div class="sourceCode" id="cb192"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">drinks_smaller</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span>names_to <span class="op">=</span> <span class="st">"type"</span>, </span>
<span>               values_to <span class="op">=</span> <span class="st">"servings"</span>, </span>
<span>               cols <span class="op">=</span> <span class="va">beer</span><span class="op">:</span><span class="va">wine</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Converting “wide” format data to “tidy” format often confuses new R users. The only way to get comfortable with the <code><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer()</a></code> function is with practice, practice, and more practice using different datasets. For example, run <code><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">?pivot_longer</a></code> and look at the examples in the bottom of the help file.</p>
<p>If, however, you want to convert a “tidy” data frame to “wide” format, you will need to use the <code><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider()</a></code> function instead. Run <code><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">?pivot_wider</a></code> and look at the examples in the bottom of the help file for examples.</p>
<p>You can also view examples of both <code><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer()</a></code> and <code><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider()</a></code> on the <a href="https://tidyr.tidyverse.org/dev/articles/pivot.html#pew">tidyverse.org</a> webpage. There’s a nice example to check out the different functions available for data tidying and a case study using data from the World Health Organization on that webpage. Furthermore, each week the R4DS Online Learning Community posts a dataset in the weekly <a href="https://github.com/rfordatascience/tidytuesday"><code>#</code>TidyTuesday event</a> that might serve as a nice place for you to find other data to explore and transform.</p>
</section></section><section id="other-commands" class="level2" data-number="2.8"><h2 data-number="2.8" class="anchored" data-anchor-id="other-commands">
<span class="header-section-number">2.8</span> Other commands</h2>
<!-- Look at the code used in the Temperance section of chapter 7. Explain all the key parts here, including rowwise, ungroup and matrices. Also, see the Preliminaries parts of the associated tutorials.  -->
<!-- Are these commands worth covering? -->
<!-- tidyr::separate_rows() -->
<!-- dplyr::coalesce() -->
<!-- expand(data, ...) -->
<!-- crossing(...) -->
<!-- nesting(...) -->
<!-- - dplyr's function (cut?) to turn continuous data into categorical data. expand() to see up data frames for creating all possible combinations? -->
<p>Here are some topics which will prove important later in the <em>Primer</em>.</p>
<section id="random-variables" class="level3" data-number="2.8.1"><h3 data-number="2.8.1" class="anchored" data-anchor-id="random-variables">
<span class="header-section-number">2.8.1</span> Random variables</h3>
<section id="sample" class="level4" data-number="2.8.1.1"><h4 data-number="2.8.1.1" class="anchored" data-anchor-id="sample">
<span class="header-section-number">2.8.1.1</span> <code>sample()</code>
</h4>
<p>The most common distributions you will work with are <em>empirical</em> or <em>frequency</em> distributions, the values of <code>age</code> in the <code>trains</code> tibble, the values of <code>poverty</code> in the <code>kenya</code> tibble, and so on. But we can also create our own data by making “draws” from a distribution which we have concocted.</p>
<p>Consider the distribution of the possible values from rolling a fair die. We can use the <code><a href="https://rdrr.io/r/base/sample.html">sample()</a></code> function to create draws from this distribution, meaning it will change (or sometimes stay the same) for every subsequent draw.</p>
<div class="cell">

</div>
<div class="cell">
<div class="sourceCode" id="cb193"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">die</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">5</span>, <span class="fl">6</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">die</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3</code></pre>
</div>
</div>
<p>This produces one “draw” from the distribution of the possible values of one roll of fair six-sided die.</p>
<p>Now, suppose we wanted to roll this die 10 times. One of the arguments of the <code><a href="https://rdrr.io/r/base/sample.html">sample()</a></code> function is <code>replace</code>. We must specify it as <code>TRUE</code> if values can appear more than once. Since, when rolling a die 10 times, we expect that a value like 3 can appear more than once, we need to set <code>replace = TRUE</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb195"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">die</span>, size <span class="op">=</span> <span class="fl">10</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 5 6 3 3 3 4 3 6 4 5</code></pre>
</div>
</div>
<p>In other words, rolling a 1 on the first roll should not preclude you from rolling a 1 on a later roll.</p>
<p>What if the die is not “fair,” meaning that some sides are more likely to appear than others? The final argument of the <code><a href="https://rdrr.io/r/base/sample.html">sample()</a></code> function is the <code>prob</code> argument. It takes a vector (of the same length as the initial vector <code>x</code>) that contains all of the probabilities of selecting each one of the elements of <code>x</code>. Suppose that the probability of rolling a 1 was 0.5, and the probability of rolling any other value is 0.1. (These probabilities should sum to 1. If they don’t <code><a href="https://rdrr.io/r/base/sample.html">sample()</a></code> will automatically re-scale them.)</p>
<div class="cell">
<div class="sourceCode" id="cb197"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">die</span>, </span>
<span>       size <span class="op">=</span> <span class="fl">10</span>, </span>
<span>       replace <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>       prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 1 1 3 1 2 1 1 6 1 1</code></pre>
</div>
</div>
<!-- DK: Keep this big picture discussion? And after the plot? -->
<p><strong>Remember: There is no real data here.</strong> We have not actually rolled a die. We have just made some assumptions about what would happen if we were to roll a die. With those assumptions we have built an urn — a <em>data generating mechanism</em> — from which we can draw as many values as we like. Let’s roll the unfair die 10,000 times.</p>
<div class="cell">
<div class="sourceCode" id="cb199"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>result <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">die</span>, </span>
<span>                       size <span class="op">=</span> <span class="fl">10000</span>, </span>
<span>                       replace <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>                       prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">result</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Distribution of Results of an Unfair Die"</span>,</span>
<span>         x <span class="op">=</span> <span class="st">"Result of One Roll"</span>,</span>
<span>         y <span class="op">=</span> <span class="st">"Count"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">6</span>,</span>
<span>                       labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/comma.html">comma_format</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="02-wrangling_files/figure-html/unnamed-chunk-89-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p><code><a href="https://rdrr.io/r/base/sample.html">sample()</a></code> is just one of many functions for creating draws — or, more colloquially, “drawing” — from a distribution. Three of the most important functions are: <code><a href="https://rdrr.io/r/stats/Uniform.html">runif()</a></code>, <code><a href="https://rdrr.io/r/stats/Binomial.html">rbinom()</a></code>, and <code><a href="https://rdrr.io/r/stats/Normal.html">rnorm()</a></code>.</p>
</section><section id="runif" class="level4" data-number="2.8.1.2"><h4 data-number="2.8.1.2" class="anchored" data-anchor-id="runif">
<span class="header-section-number">2.8.1.2</span> <code>runif()</code>
</h4>
<p>Consider a “uniform” distribution. This is the case in which every outcome in the range of possible outcomes has the same chance of occurring. The function <code><a href="https://rdrr.io/r/stats/Uniform.html">runif()</a></code> (spoken as “r-unif”) enables us to draw from a uniform contribution. <code><a href="https://rdrr.io/r/stats/Uniform.html">runif()</a></code> has three arguments: <code>n</code>, <code>min</code>, and <code>max</code>. <code><a href="https://rdrr.io/r/stats/Uniform.html">runif()</a></code> will produce <code>n</code> draws from between <code>min</code> and <code>max</code>, with each value having an equal chance of occurring.</p>
<div class="cell">
<div class="sourceCode" id="cb200"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span>, min <span class="op">=</span> <span class="fl">4</span>, max <span class="op">=</span> <span class="fl">6</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 5.594800 4.981960 4.601993 5.738417 4.879622 5.155263 4.319479 5.627666
 [9] 4.800110 5.634794</code></pre>
</div>
</div>
<p>Mathematically, we would notate:</p>
<p><span class="math display">\[y_i \sim U(4, 6)\]</span>,</p>
<p>This means that the each value for <span class="math inline">\(y\)</span> is drawn from a uniform distribution between four and six.</p>
</section><section id="rbinom" class="level4" data-number="2.8.1.3"><h4 data-number="2.8.1.3" class="anchored" data-anchor-id="rbinom">
<span class="header-section-number">2.8.1.3</span> <code>rbinom()</code>
</h4>
<p>Consider binomial distribution, the case in which the probability of some Boolean variable (for instance success or failure) is calculated for repeated, independent trials. One common example would be the probability of flipping a coin and landing on heads. The function <code><a href="https://rdrr.io/r/stats/Binomial.html">rbinom()</a></code> allows us to draw from a binomial distribution. This function takes three arguments, <code>n</code>, <code>size</code>, and <code>prob</code>.</p>
<p><em><code>n</code> is the number of values we seek to draw. </em><code>size</code> is the number of trials for each <code>n</code>. *<code>prob</code> is the probability of success on each trial.</p>
<p>Suppose we wanted to flip a fair coin one time, and let landing on heads represent success.</p>
<div class="cell">
<div class="sourceCode" id="cb202"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html">rbinom</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">1</span> , size <span class="op">=</span> <span class="fl">1</span>, prob <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
</div>
<p>Do the same thing 100 times:</p>
<div class="cell">
<div class="sourceCode" id="cb204"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>heads <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html">rbinom</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">100</span>, size <span class="op">=</span> <span class="fl">1</span>, prob <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">heads</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Flipping a Fair Coin 100 Times"</span>,</span>
<span>         x <span class="op">=</span> <span class="st">"Result"</span>,</span>
<span>         y <span class="op">=</span> <span class="st">"Count"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>                       labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Tails"</span>, <span class="st">"Heads"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="02-wrangling_files/figure-html/unnamed-chunk-92-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>In our graph above, we use the function <code><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous()</a></code> because our x-axis variable is continuous, meaning it can take on any real values. The <code>breaks</code> argument to <code><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous()</a></code> converts our x-axis to having two different “tick marks”. There is a fairly even distribution of Tails and Heads. More draws would typically result in an even more equal split.</p>
<p>Randomness creates (inevitable) tension between distribution as a “thing” and distribution as a vector of draws from that thing. In this case, the vector of draws is not balanced between Tails and Heads. Yet, we “know” that it should be since the coin is, by definition, fair. In a sense, the mathematics require an even split. Yet, randomness means that the vector of draws will rarely match the mathematically “true” result. And that is OK! First, randomness is an intrinsic property of the real world. Second, we can make the effect of randomness be as small as we want by increasing the number of draws.</p>
<!-- DK: Could do a little example of that, showing the convergence to 50% as n increases. -->
<p>Suppose instead we wanted to simulate an unfair coin, where the probability of landing on Heads was 0.75 instead of 0.25.</p>
<div class="cell">
<div class="sourceCode" id="cb205"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>heads <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html">rbinom</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">100</span>, size <span class="op">=</span> <span class="fl">1</span>, prob <span class="op">=</span> <span class="fl">0.75</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">heads</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Flipping a Fair Coin 100 Times"</span>,</span>
<span>         x <span class="op">=</span> <span class="st">"Result"</span>,</span>
<span>         y <span class="op">=</span> <span class="st">"Count"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>                       labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Tails"</span>, <span class="st">"Heads"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="02-wrangling_files/figure-html/unnamed-chunk-93-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The distribution — the imaginary urn — from which we draw the results of a coin flip for a fair coin is a different distribution — a different imaginary urn — from the distribution for a biased coin. In fact, there are an infinite number of distributions. <em>Yet as long as we can draw values from a distribution, we can work with it.</em> Mathematics:</p>
<p><span class="math display">\[y_i \sim B(n, p)\]</span>.</p>
<p>Each value for <span class="math inline">\(y\)</span> is drawn from a binomial distribution with parameters <span class="math inline">\(n\)</span> for the number of trials and <span class="math inline">\(p\)</span> for the probability of success.</p>
<p>Instead of each <code>n</code> consisting of a single trial, we could have situation in which we are, 10,000 times, flipping a coin 10 times and summing up, for each experiment, the number of heads. In that case:</p>
<div class="cell">
<div class="sourceCode" id="cb206"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">9</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>heads <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html">rbinom</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10000</span>, size <span class="op">=</span> <span class="fl">10</span>, prob <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">heads</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Flipping a Fair Coin 10 Times"</span>,</span>
<span>         subtitle <span class="op">=</span> <span class="st">"Extreme results are possible with enough experiments"</span>,</span>
<span>         x <span class="op">=</span> <span class="st">"Total Number of Heads in Ten Flips"</span>,</span>
<span>         y <span class="op">=</span> <span class="st">"Count"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="02-wrangling_files/figure-html/unnamed-chunk-94-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section><section id="sec-normal" class="level4" data-number="2.8.1.4"><h4 data-number="2.8.1.4" class="anchored" data-anchor-id="sec-normal">
<span class="header-section-number">2.8.1.4</span> <code>rnorm()</code>
</h4>
<p>The most important distribution is the <em>normal distribution</em>. Mathematics:</p>
<p><span class="math display">\[y_i \sim N(\mu, \sigma^2)\]</span>.</p>
<p>Each value <span class="math inline">\(y_i\)</span> is drawn from a normal distribution with parameters <span class="math inline">\(\mu\)</span> for the mean and <span class="math inline">\(\sigma\)</span> for the standard deviation.</p>
<p>This bell-shaped distribution is defined by two parameters: (1) the <em>mean</em> <span class="math inline">\(\mu\)</span> (spoken as “mu”) which locates the center of the distribution and (2) the <em>standard deviation</em> <span class="math inline">\(\sigma\)</span> (spoken as “sigma”) which determines the variation of values around that center. In the figure below, we plot three normal distributions where:</p>
<ol type="1">
<li>The solid normal curve has mean <span class="math inline">\(\mu = 5\)</span> &amp; standard deviation <span class="math inline">\(\sigma = 2\)</span>.</li>
<li>The dotted normal curve has mean <span class="math inline">\(\mu = 5\)</span> &amp; standard deviation <span class="math inline">\(\sigma = 5\)</span>.</li>
<li>The dashed normal curve has mean <span class="math inline">\(\mu = 15\)</span> &amp; standard deviation <span class="math inline">\(\sigma = 2\)</span>.</li>
</ol>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="02-wrangling_files/figure-html/unnamed-chunk-95-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Three normal distributions.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>Notice how the solid and dotted line normal curves have the same center due to their common mean <span class="math inline">\(\mu\)</span> = 5. However, the dotted line normal curve is wider due to its larger standard deviation of <span class="math inline">\(\sigma = 5\)</span>. On the other hand, the solid and dashed line normal curves have the same variation due to their common standard deviation <span class="math inline">\(\sigma = 2\)</span>. However, they are centered at different locations.</p>
<p>When the mean <span class="math inline">\(\mu = 0\)</span> and the standard deviation <span class="math inline">\(\sigma = 1\)</span>, the normal distribution has a special name. It’s called the <em>standard normal distribution</em> or the <em><span class="math inline">\(z\)</span>-curve</em>.</p>
<p>Furthermore, if a variable follows a normal curve, there are <em>three rules of thumb</em> we can use:</p>
<ol type="1">
<li>68% of values will lie within <span class="math inline">\(\pm\)</span> 1 standard deviation of the mean.</li>
<li>95% of values will lie within <span class="math inline">\(\pm\)</span> 1.96 <span class="math inline">\(\approx\)</span> 2 standard deviations of the mean.</li>
<li>99.7% of values will lie within <span class="math inline">\(\pm\)</span> 3 standard deviations of the mean.</li>
</ol>
<p>Let’s illustrate this on a standard normal curve. The dashed lines are at -3, -1.96, -1, 0, 1, 1.96, and 3. These 7 lines cut up the x-axis into 8 segments. The areas under the normal curve for each of the 8 segments are marked and add up to 100%. For example:</p>
<ol type="1">
<li>The middle two segments represent the interval -1 to 1. The shaded area above this interval represents 34% + 34% = 68% of the area under the curve. In other words, 68% of values.</li>
<li>The middle four segments represent the interval -1.96 to 1.96. The shaded area above this interval represents 13.5% + 34% + 34% + 13.5% = 95% of the area under the curve. In other words, 95% of values.</li>
<li>The middle six segments represent the interval -3 to 3. The shaded area above this interval represents 2.35% + 13.5% + 34% + 34% + 13.5% + 2.35% = 99.7% of the area under the curve. In other words, 99.7% of values.</li>
</ol>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="02-wrangling_files/figure-html/unnamed-chunk-96-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Rules of thumb about areas under normal curves.</figcaption><p></p>
</figure>
</div>
</div>
</div>
</section></section><section id="combinations" class="level3" data-number="2.8.2"><h3 data-number="2.8.2" class="anchored" data-anchor-id="combinations">
<span class="header-section-number">2.8.2</span> Combinations</h3>
<p>We often need to create a tibble with all the possible combinations of two or more variables. <code><a href="https://tidyr.tidyverse.org/reference/expand_grid.html">expand_grid()</a></code> is the easiest approach.</p>
<div class="cell">
<div class="sourceCode" id="cb207"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/expand_grid.html">expand_grid</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"B"</span><span class="op">)</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 8 × 2
  x         y
  &lt;chr&gt; &lt;dbl&gt;
1 A         1
2 A         2
3 A         3
4 A         4
5 B         1
6 B         2
7 B         3
8 B         4</code></pre>
</div>
</div>
<p><code><a href="https://tidyr.tidyverse.org/reference/expand.html">crossing()</a></code> does something similar if the input variables are already in a tibble.</p>
</section><section id="matrices" class="level3" data-number="2.8.3"><h3 data-number="2.8.3" class="anchored" data-anchor-id="matrices">
<span class="header-section-number">2.8.3</span> Matrices</h3>
<p>Recall that a “matrix” in R is a rectangular array of data, shaped like a data frame or tibble, but containing only one type of data, e.g., numeric. Large matrices also print out ugly. (There are other differences, none of which we care about here.) Example:</p>
<div class="cell">
<div class="sourceCode" id="cb209"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">8</span>, <span class="fl">9</span>, <span class="fl">12</span>, <span class="fl">13</span>, <span class="fl">0</span>, <span class="fl">15</span>, <span class="op">-</span><span class="fl">1</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">m</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2] [,3]
[1,]    3    9    0
[2,]    4   12   15
[3,]    8   13   -1</code></pre>
</div>
</div>
<p>The easiest way to pull information from a matrix is to use <code>[ ]</code>, the subset operator. Here is how we grab the second and third columns of <code>m</code>:</p>
<div class="cell">
<div class="sourceCode" id="cb211"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">m</span><span class="op">[</span>, <span class="fl">2</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2]
[1,]    9    0
[2,]   12   15
[3,]   13   -1</code></pre>
</div>
</div>
<p>Note, however, that matrices with just one dimension “collapse” into single vectors:</p>
<div class="cell">
<div class="sourceCode" id="cb213"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">m</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  9 12 13</code></pre>
</div>
</div>
<p>Tibbles, on the other hand, always maintain their rectangular shapes, even with only one column or row.</p>
<p>We can turn matrices into tibbles with <code><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble()</a></code>.</p>
<div class="cell">
<div class="sourceCode" id="cb215"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">m</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: The `x` argument of `as_tibble.matrix()` must have unique column names if `.name_repair` is omitted as of tibble 2.0.0.
Using compatibility `.name_repair`.
This warning is displayed once every 8 hours.
Call `lifecycle::last_lifecycle_warnings()` to see where this warning was generated.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 3
     V1    V2    V3
  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1     3     9     0
2     4    12    15
3     8    13    -1</code></pre>
</div>
</div>
<p>Because <code>m</code> does not have column names, <code><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble()</a></code> creates its won variables names, using “V” for variable.</p>
</section><section id="missing-values" class="level3" data-number="2.8.4"><h3 data-number="2.8.4" class="anchored" data-anchor-id="missing-values">
<span class="header-section-number">2.8.4</span> Missing Values</h3>
<p>Some observations in a tibble are blank. These are called missing values, and they are often marked as <code>NA</code>. We can create such a tibble as follows:</p>
<div class="cell">
<div class="sourceCode" id="cb218"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">tbl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html">tribble</a></span><span class="op">(</span></span>
<span>  <span class="op">~</span> <span class="va">a</span>, <span class="op">~</span> <span class="va">b</span>, <span class="op">~</span> <span class="va">c</span>,</span>
<span>    <span class="fl">2</span>,   <span class="fl">3</span>,   <span class="fl">5</span>,</span>
<span>    <span class="fl">4</span>,  <span class="cn">NA</span>,   <span class="fl">8</span>,</span>
<span>   <span class="cn">NA</span>,   <span class="fl">7</span>,   <span class="fl">9</span>,</span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">tbl</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 3
      a     b     c
  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1     2     3     5
2     4    NA     8
3    NA     7     9</code></pre>
</div>
</div>
<p>The presence of <code>NA</code> values can be problematic.</p>
<div class="cell">
<div class="sourceCode" id="cb220"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">tbl</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>avg_a <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">a</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 1
  avg_a
  &lt;dbl&gt;
1    NA</code></pre>
</div>
</div>
<p>Fortunately, most R functions take an argument, <code>na.rm</code>, which, when set to <code>TRUE</code>, removes NA values from any calculations.</p>
<div class="cell">
<div class="sourceCode" id="cb222"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">tbl</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>avg_a <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">a</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 1
  avg_a
  &lt;dbl&gt;
1     3</code></pre>
</div>
</div>
<p>Another approach is to use <code><a href="https://tidyr.tidyverse.org/reference/drop_na.html">drop_na()</a></code>.</p>
<div class="cell">
<div class="sourceCode" id="cb224"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">tbl</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/drop_na.html">drop_na</a></span><span class="op">(</span><span class="va">a</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 3
      a     b     c
  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1     2     3     5
2     4    NA     8</code></pre>
</div>
</div>
<p>However, be careful! If you use <code><a href="https://tidyr.tidyverse.org/reference/drop_na.html">drop_na()</a></code> without a specific variable provided, you will remove all rows with a missing value for any variable in the tibble.</p>
<div class="cell">
<div class="sourceCode" id="cb226"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">tbl</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/drop_na.html">drop_na</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 3
      a     b     c
  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1     2     3     5</code></pre>
</div>
</div>
<p>A final approach is to use <code><a href="https://rdrr.io/r/base/NA.html">is.na()</a></code> to explicitly determine if a value is missing.</p>
<div class="cell">
<div class="sourceCode" id="cb228"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">tbl</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>a_missing <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">a</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
      a     b     c a_missing
  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;lgl&gt;    
1     2     3     5 FALSE    
2     4    NA     8 FALSE    
3    NA     7     9 TRUE     </code></pre>
</div>
</div>
</section><section id="working-by-rows" class="level3" data-number="2.8.5"><h3 data-number="2.8.5" class="anchored" data-anchor-id="working-by-rows">
<span class="header-section-number">2.8.5</span> Working by rows</h3>
<p>Tibbles and the main Tidyverse functions are designed to work by columns. You do something to all the values for variable <code>a</code>. But, sometimes, we want to work <code>across</code> the tibble, comparing the value for <code>a</code> in the first row to the value of <code>b</code> in the first row, and so on. To do that, we need two tricks. First, we use <code><a href="https://dplyr.tidyverse.org/reference/rowwise.html">rowwise()</a></code> to inform R that the next set of commands should be executed across the rows.</p>
<div class="cell">
<div class="sourceCode" id="cb230"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">tbl</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rowwise.html">rowwise</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 3
# Rowwise: 
      a     b     c
  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1     2     3     5
2     4    NA     8
3    NA     7     9</code></pre>
</div>
</div>
<p>Note how “# Rowwise:” is printed out. Having set up the pipe to work across rows, we need to pass <code><a href="https://dplyr.tidyverse.org/reference/c_across.html">c_across()</a></code> to whichever function we are using, generally specifying the variables we want to use. If we don’t provide any arguments to <code><a href="https://dplyr.tidyverse.org/reference/c_across.html">c_across()</a></code>, it will use all the columns in the tibble.</p>
<div class="cell">
<div class="sourceCode" id="cb232"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">tbl</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rowwise.html">rowwise</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>sum_a_c <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/c_across.html">c_across</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">a</span>, <span class="va">c</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>largest <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/c_across.html">c_across</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>largest_na <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/c_across.html">c_across</a></span><span class="op">(</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 6
# Rowwise: 
      a     b     c sum_a_c largest largest_na
  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;      &lt;dbl&gt;
1     2     3     5       7       7          7
2     4    NA     8      12      NA         12
3    NA     7     9      NA      NA          9</code></pre>
</div>
</div>
</section><section id="using-skim" class="level3" data-number="2.8.6"><h3 data-number="2.8.6" class="anchored" data-anchor-id="using-skim">
<span class="header-section-number">2.8.6</span> Using <code>skim()</code>
</h3>
<p>The <strong><code>skimr</code></strong> package offers a very useful function known as the <code><a href="https://docs.ropensci.org/skimr/reference/skim.html">skim()</a></code> function, allowing you to get valuable information from the data set in one glance. This is similar to the <code><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse()</a></code> function, but it’s a little more detailed and offers some preliminary analysis of the topic.</p>
<p>Let’s try skimming the <code>nhanes</code> dataset.</p>
<div class="cell">
<div class="sourceCode" id="cb234"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://docs.ropensci.org/skimr/reference/skim.html">skim</a></span><span class="op">(</span><span class="va">nhanes</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped">
<caption>Data summary</caption>
<tbody>
<tr class="odd">
<td style="text-align: left;">Name</td>
<td style="text-align: left;">nhanes</td>
</tr>
<tr class="even">
<td style="text-align: left;">Number of rows</td>
<td style="text-align: left;">10000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Number of columns</td>
<td style="text-align: left;">15</td>
</tr>
<tr class="even">
<td style="text-align: left;">_______________________</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Column type frequency:</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">character</td>
<td style="text-align: left;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">factor</td>
<td style="text-align: left;">3</td>
</tr>
<tr class="even">
<td style="text-align: left;">numeric</td>
<td style="text-align: left;">10</td>
</tr>
<tr class="odd">
<td style="text-align: left;">________________________</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">Group variables</td>
<td style="text-align: left;">None</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: character</strong></p>
<table class="table table-sm table-striped">
<colgroup>
<col style="width: 19%">
<col style="width: 13%">
<col style="width: 19%">
<col style="width: 5%">
<col style="width: 5%">
<col style="width: 8%">
<col style="width: 12%">
<col style="width: 15%">
</colgroup>
<thead><tr class="header">
<th style="text-align: left;">skim_variable</th>
<th style="text-align: right;">n_missing</th>
<th style="text-align: right;">complete_rate</th>
<th style="text-align: right;">min</th>
<th style="text-align: right;">max</th>
<th style="text-align: right;">empty</th>
<th style="text-align: right;">n_unique</th>
<th style="text-align: right;">whitespace</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">gender</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">race</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: factor</strong></p>
<table class="table table-sm table-striped">
<colgroup>
<col style="width: 14%">
<col style="width: 10%">
<col style="width: 14%">
<col style="width: 8%">
<col style="width: 9%">
<col style="width: 43%">
</colgroup>
<thead><tr class="header">
<th style="text-align: left;">skim_variable</th>
<th style="text-align: right;">n_missing</th>
<th style="text-align: right;">complete_rate</th>
<th style="text-align: left;">ordered</th>
<th style="text-align: right;">n_unique</th>
<th style="text-align: left;">top_counts</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">education</td>
<td style="text-align: right;">2779</td>
<td style="text-align: right;">0.72</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: right;">4</td>
<td style="text-align: left;">Som: 2267, Col: 2098, Hig: 1517, Mid: 1339</td>
</tr>
<tr class="even">
<td style="text-align: left;">hh_income</td>
<td style="text-align: right;">811</td>
<td style="text-align: right;">0.92</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: right;">12</td>
<td style="text-align: left;">mor: 2220, 750: 1084, 250: 958, 350: 863</td>
</tr>
<tr class="odd">
<td style="text-align: left;">depressed</td>
<td style="text-align: right;">3327</td>
<td style="text-align: right;">0.67</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;">Non: 5246, Sev: 1009, Mos: 418</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: numeric</strong></p>
<table class="table table-sm table-striped">
<colgroup>
<col style="width: 15%">
<col style="width: 10%">
<col style="width: 14%">
<col style="width: 8%">
<col style="width: 6%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 6%">
</colgroup>
<thead><tr class="header">
<th style="text-align: left;">skim_variable</th>
<th style="text-align: right;">n_missing</th>
<th style="text-align: right;">complete_rate</th>
<th style="text-align: right;">mean</th>
<th style="text-align: right;">sd</th>
<th style="text-align: right;">p0</th>
<th style="text-align: right;">p25</th>
<th style="text-align: right;">p50</th>
<th style="text-align: right;">p75</th>
<th style="text-align: right;">p100</th>
<th style="text-align: left;">hist</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">survey</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">2010.00</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">2009.00</td>
<td style="text-align: right;">2009.00</td>
<td style="text-align: right;">2010.00</td>
<td style="text-align: right;">2011.00</td>
<td style="text-align: right;">2011.00</td>
<td style="text-align: left;">▇▁▁▁▇</td>
</tr>
<tr class="even">
<td style="text-align: left;">age</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">36.74</td>
<td style="text-align: right;">22.40</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">17.00</td>
<td style="text-align: right;">36.00</td>
<td style="text-align: right;">54.00</td>
<td style="text-align: right;">80.00</td>
<td style="text-align: left;">▇▇▇▆▅</td>
</tr>
<tr class="odd">
<td style="text-align: left;">weight</td>
<td style="text-align: right;">78</td>
<td style="text-align: right;">0.99</td>
<td style="text-align: right;">70.98</td>
<td style="text-align: right;">29.13</td>
<td style="text-align: right;">2.80</td>
<td style="text-align: right;">56.10</td>
<td style="text-align: right;">72.70</td>
<td style="text-align: right;">88.90</td>
<td style="text-align: right;">230.70</td>
<td style="text-align: left;">▂▇▂▁▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">height</td>
<td style="text-align: right;">353</td>
<td style="text-align: right;">0.96</td>
<td style="text-align: right;">161.88</td>
<td style="text-align: right;">20.19</td>
<td style="text-align: right;">83.60</td>
<td style="text-align: right;">156.80</td>
<td style="text-align: right;">166.00</td>
<td style="text-align: right;">174.50</td>
<td style="text-align: right;">200.40</td>
<td style="text-align: left;">▁▁▁▇▂</td>
</tr>
<tr class="odd">
<td style="text-align: left;">bmi</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">0.96</td>
<td style="text-align: right;">26.66</td>
<td style="text-align: right;">7.38</td>
<td style="text-align: right;">12.88</td>
<td style="text-align: right;">21.58</td>
<td style="text-align: right;">25.98</td>
<td style="text-align: right;">30.89</td>
<td style="text-align: right;">81.25</td>
<td style="text-align: left;">▇▆▁▁▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">pulse</td>
<td style="text-align: right;">1437</td>
<td style="text-align: right;">0.86</td>
<td style="text-align: right;">73.56</td>
<td style="text-align: right;">12.16</td>
<td style="text-align: right;">40.00</td>
<td style="text-align: right;">64.00</td>
<td style="text-align: right;">72.00</td>
<td style="text-align: right;">82.00</td>
<td style="text-align: right;">136.00</td>
<td style="text-align: left;">▂▇▃▁▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">diabetes</td>
<td style="text-align: right;">142</td>
<td style="text-align: right;">0.99</td>
<td style="text-align: right;">0.08</td>
<td style="text-align: right;">0.27</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: left;">▇▁▁▁▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">general_health</td>
<td style="text-align: right;">2461</td>
<td style="text-align: right;">0.75</td>
<td style="text-align: right;">3.38</td>
<td style="text-align: right;">0.94</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">3.00</td>
<td style="text-align: right;">3.00</td>
<td style="text-align: right;">4.00</td>
<td style="text-align: right;">5.00</td>
<td style="text-align: left;">▁▃▇▇▂</td>
</tr>
<tr class="odd">
<td style="text-align: left;">pregnancies</td>
<td style="text-align: right;">7396</td>
<td style="text-align: right;">0.26</td>
<td style="text-align: right;">3.03</td>
<td style="text-align: right;">1.80</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">2.00</td>
<td style="text-align: right;">3.00</td>
<td style="text-align: right;">4.00</td>
<td style="text-align: right;">32.00</td>
<td style="text-align: left;">▇▁▁▁▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">sleep</td>
<td style="text-align: right;">2245</td>
<td style="text-align: right;">0.78</td>
<td style="text-align: right;">6.93</td>
<td style="text-align: right;">1.35</td>
<td style="text-align: right;">2.00</td>
<td style="text-align: right;">6.00</td>
<td style="text-align: right;">7.00</td>
<td style="text-align: right;">8.00</td>
<td style="text-align: right;">12.00</td>
<td style="text-align: left;">▁▅▇▁▁</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>The <code><a href="https://docs.ropensci.org/skimr/reference/skim.html">skim()</a></code> function provides information such as the mean, the number of unique counts, and even bar graphs about the distribution of the data. This information is extremely useful because it allows us to easily find things about that data and give us a starting point. For example, there are over 7000 missing values for the pregnancies variable. That means that we’re going to have to run <code><a href="https://tidyr.tidyverse.org/reference/drop_na.html">drop_na()</a></code> so that we can ignore those 7000 missing values.</p>
<p>By running <code><a href="https://docs.ropensci.org/skimr/reference/skim.html">skim()</a></code> you can create a starting point, both for your analysis and for the creation of your graph.</p>
</section></section><section id="summary" class="level2" data-number="2.9"><h2 data-number="2.9" class="anchored" data-anchor-id="summary">
<span class="header-section-number">2.9</span> Summary</h2>
<!-- DK: Discuss base versus Tidyverse -->
<p><em>Data science is data cleaning.</em></p>
<p><em>Real data is nasty.</em></p>
<p>This chapter covered many, many commands. You should have them all memorized by now.</p>
<p>No! That is ridiculous. We don’t have them all memorized. Why should you? The point of this chapter was to give you a tour of what you can do in R and how to do it. With that information, you have a base from which to try to solve the problems you will encounter in the future.</p>
<!-- DK: I am eliding over distributions of numbers (easy) and of values, like race. Should go back and have binom return "Head". Or maybe this is subtle enough that I can ignore it. Also, should make clear that sample() is, conceptually, taking draws from trains$age. Or, rather, trains$age is some draw from an imaginary distribution or population. -->
<p>The key data science concept from this chapter is, again, the idea of a “distribution.” The word distribution is used in two very different ways. First, a distribution is an invisible object that you can never see or touch. It is the imaginary urn from which you can take draws. Only in very special cases will you ever be able to “know” what the distribution is, mainly in cases where there is a physical process, like a roulette wheel, which you can inspect or in the case of an assumed mathematical formula. In almost all real world data science problems, the “distribution” is a mental creation whose reality you can never confirm.</p>
<p>The second way that the word distribution is used is to refer to a vector of values, a variable in an R tibble. The 115 ages in <code>trains</code> are a distribution as are 1,000 draws from <code><a href="https://rdrr.io/r/stats/Normal.html">rnorm()</a></code>.</p>
<p>Whether “distribution” means the imaginary object or a vector of numbers drawn from that imaginary object depends on context.</p>
<div class="cell">

</div>


<div id="refs" class="references csl-bib-body hanging-indent" role="doc-bibliography" style="display: none">
<div id="ref-R-tidyr" class="csl-entry" role="doc-biblioentry">
Wickham, Hadley, and Maximilian Girlich. 2022. <em>Tidyr: Tidy Messy Data</em>. <a href="https://CRAN.R-project.org/package=tidyr">https://CRAN.R-project.org/package=tidyr</a>.
</div>
</div>
</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./01-visualization.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Visualization</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./03-data.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Data</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>